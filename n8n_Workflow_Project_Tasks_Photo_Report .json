{
  "name": "My workflow 4",
  "nodes": [
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "register_user"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å register_user1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        544,
        192
      ],
      "id": "4f453955-683a-4497-8a76-b541eca4c669"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 1001730935,
          "mode": "list",
          "cachedResultName": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug/edit#gid=1001730935"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "Telegram ID"
            }
          ]
        },
        "options": {}
      },
      "name": "–ß–∏—Ç–∞—Ç—å –ª–∏—Å—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        752,
        176
      ],
      "id": "35e48c4a-eec1-4fad-b0ec-0dd852553bdf",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\nconst items = $input.all();\nconst chatId = String($node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json.chatId);\nconst userName = $node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json.userName;\nconst userId = $node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json.userId;\nconst now = new Date();\nconst registrationDate = now.toLocaleDateString('ru-RU');\nconst registrationTime = now.toLocaleString('ru-RU');\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ —Ç–∞–±–ª–∏—Ü–µ\nlet userExists = false;\nlet userRow = null;\n\nitems.forEach((item, index) => {\n  if (index === 0) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫\n  \n  const itemChatId = String(item.json['ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è'] || '').trim();\n  if (itemChatId === chatId) {\n    userExists = true;\n    userRow = item.json;\n  }\n});\n\nif (userExists) {\n  // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω\n  return [{\n    json: {\n      action: 'send_welcome_existing',\n      chatId: chatId,\n      userName: userRow['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'] || userName,\n      registrationDate: userRow['–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏'] || registrationDate,\n      userExists: true\n    }\n  }];\n} else {\n  // –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –Ω—É–∂–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è\n  return [{\n    json: {\n      action: 'register_new_user',\n      chatId: chatId,\n      userName: userName,\n      userId: userId,\n      registrationDate: registrationDate,\n      registrationTime: registrationTime,\n      userExists: false\n    }\n  }];\n}\n"
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        928,
        272
      ],
      "id": "c106e240-f8fe-4876-8d47-89fbd597f94b"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "register_new_user"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1104,
        160
      ],
      "id": "d8e6daf0-7a4a-492b-b0c9-c19388ec5dd2"
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\nconst userData = $input.first().json;\nconst chatId = userData.chatId;\nconst userName = userData.userName;\nconst isNewUser = userData.action === 'register_new_user';\n\nlet message;\n\nif (isNewUser) {\n  // –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  message = `üéâ **–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${userName}!**\\n\\n`;\n  message += `‚úÖ –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–æ–≤.\\n\\n`;\n  message += `üÜî –í–∞—à Telegram ID: \\`${chatId}\\`\\n\\n`;\n  message += `üìã **–í–∞—à–∏ —Ç–∏–ø—ã –æ—Ç—á–µ—Ç–æ–≤:**\\n`;\n  message += `‚Ä¢ –§–æ—Ç–æ –æ–±—â–µ–≥–æ –∂—É—Ä–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç\\n`;\n  message += `‚Ä¢ –§–æ—Ç–æ –æ—Ç—á—ë—Ç —Å–≤–∞—Ä–æ—á–Ω—ã—Ö —Ä–∞–±–æ—Ç\\n`;\n  message += `‚Ä¢ –§–æ—Ç–æ –æ—Ç—á—ë—Ç –±–µ—Ç–æ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç\\n`;\n  message += `‚Ä¢ –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Ç–µ—Ö–Ω–∏–∫–∏\\n`;\n  message += `‚Ä¢ –§–æ—Ç–æ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\\n\\n`;\n  message += `üì∏ **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –±–æ—Ç–æ–º:**\\n`;\n  message += `1. –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –æ—Ç—á–µ—Ç–∞—Ö\\n`;\n  message += `2. –û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è, –ø—Ä–∏–∫—Ä–µ–ø–ª—è—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏\\n`;\n  message += `3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ñ–æ—Ç–æ\\n\\n`;\n  message += `**–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\\n`;\n  message += `/help - –°–ø—Ä–∞–≤–∫–∞ –ø–æ —Ä–∞–±–æ—Ç–µ —Å –±–æ—Ç–æ–º\\n`;\n  message += `/report - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –≤—Ä—É—á–Ω—É—é\\n`;\n  message += `/status - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Å–µ–≥–æ–¥–Ω—è –æ—Ç—á–µ—Ç—ã\\n`;\n  message += `/prochital - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\\n\\n`;\n  message += `–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –æ–∂–∏–¥–∞–π—Ç–µ —É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /report`;\n} else {\n  // –°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n  const regDate = userData.registrationDate || '–Ω–µ —É–∫–∞–∑–∞–Ω–∞';\n  message = `üëã **–° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º, ${userName}!**\\n\\n`;\n  message += `‚úÖ –í—ã —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –≤ —Å–∏—Å—Ç–µ–º–µ.\\n`;\n  message += `üìÖ –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ${regDate}\\n\\n`;\n  message += `üÜî –í–∞—à Telegram ID: \\`${chatId}\\`\\n\\n`;\n  message += `üìã **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\\n`;\n  message += `/prochital - –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\\n\\n`;\n  message += `–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–æ–≤ –¥–æ–∂–¥–∏—Ç–µ—Å—å —É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /report`;\n}\n\nreturn [{\n  json: {\n    action: 'send_message',\n    chatId: chatId,\n    message: message\n  }\n}];"
      },
      "name": "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        336
      ],
      "id": "c177f40a-07b1-4156-9764-21281c542ff5"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "send_welcome_existing"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1104,
        336
      ],
      "id": "cf59acbc-39ea-4378-baf7-40f6aeb0513a"
    },
    {
      "parameters": {
        "updates": [
          "message",
          "photo",
          "document"
        ],
        "additionalFields": {}
      },
      "name": "Telegram Webhook - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [
        -448,
        2016
      ],
      "id": "b7690d7d-75ae-4054-b70b-19bd74f12ddb",
      "webhookId": "photo-reports-webhook"
    },
    {
      "parameters": {
        "jsCode": "// –û–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\nconst data = $input.first().json;\nconst message = data.message || {};\nconst text = message.text || '';\nconst chatId = String(message.chat?.id || data.callback_query?.message?.chat?.id || '');\nconst userName = (message.from?.first_name || '') + ' ' + (message.from?.last_name || '');\nconst userId = String(message.from?.id || data.callback_query?.from?.id || '');\nconst messageText = text;\n\n// –ü–æ–ª—É—á–∞–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç\nconst staticData = $getWorkflowStaticData('global');\nconst foremanContext = staticData.foremanContexts?.[chatId] || {};\n\n// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏\nconst now = new Date();\nconst today = now.toLocaleDateString('ru-RU');\nconst time = now.toLocaleTimeString('ru-RU');\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–º –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ\nif (message.reply_to_message && message.reply_to_message.text && message.reply_to_message.text.includes('–î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ')) {\n  const nameMatch = text.match(/–ò–º—è:\\s*(.+)/i);\n  const companyMatch = text.match(/–ö–æ–º–ø–∞–Ω–∏—è:\\s*(.+)/i);\n  \n  const proforemanName = nameMatch ? nameMatch[1].trim() : null;\n  const company = companyMatch ? companyMatch[1].trim() : null;\n  \n  if (proforemanName && company) {\n    return [{\n      json: {\n        action: 'complete_registration',\n        chatId: chatId,\n        userId: userId,\n        proforemanName: proforemanName,\n        company: company,\n        userName: userName,\n        originalMessage: message\n      }\n    }];\n  } else {\n    return [{\n      json: {\n        action: 'send_message',\n        chatId: chatId,\n        message: '‚ùå **–û—à–∏–±–∫–∞!**\\\\n\\\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\\\\n–ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤\\\\n–ö–æ–º–ø–∞–Ω–∏—è: –°—Ç—Ä–æ–π–ú–æ–Ω—Ç–∞–∂\\\\n\\\\n–û—Ç–≤–µ—Ç—å—Ç–µ –∑–∞–Ω–æ–≤–æ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.'\n      }\n    }];\n  }\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /start\nif (text.trim().toLowerCase() === '/start') {\n  return [{\n    json: {\n      action: 'register_user',\n      chatId: chatId,\n      userName: userName,\n      userId: userId,\n      message: message\n    }\n  }];\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /help\nif (messageText.trim().toLowerCase() === '/help') {\n  return [{\n    json: {\n      action: \"send_message\",\n      chatId: chatId,\n      message: `üìö <b>–ñ—É—Ä–Ω–∞–ª –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è | –°–ø—Ä–∞–≤–∫–∞ –ø–æ –†–∞–±–æ—Ç–µ</b>\n\n–≠—Ç–æ—Ç –±–æ—Ç ‚Äî –≤–∞—à –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –Ω–∞ —Å—Ç—Ä–æ–π–∫–µ! –ö–∞–∂–¥–æ–µ —É—Ç—Ä–æ –æ–Ω –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –≤ Telegram, –∫–∞–∫–∏–µ –æ—Ç—á—ë—Ç—ã –ø–æ –∑–∞–¥–∞—á–∞–º –∏ —Ñ–æ—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞ –¥–µ–Ω—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∂—É—Ä–Ω–∞–ª —Ä–∞–±–æ—Ç, –æ—Ç—á—ë—Ç—ã –ø–æ —Å–≤–∞—Ä–∫–µ, –±–µ—Ç–æ–Ω—É, —Ç–µ—Ö–Ω–∏–∫–µ –∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã).\n\n–í—ã –ø—Ä–æ—Å—Ç–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–µ—Ç–µ –Ω—É–∂–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ —Ñ–æ—Ç–æ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –±–æ—Ç–∞. –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤—Å–µ —Ñ–æ—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü—É: –∫—Ç–æ, –∫–æ–≥–¥–∞ –∏ –∫–∞–∫–æ–π –æ—Ç—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–∏–ª.\n\n–ë–ª–∞–≥–æ–¥–∞—Ä—è –≤–∞—à–∏–º –æ—Ç–≤–µ—Ç–∞–º –º–µ–Ω–µ–¥–∂–µ—Ä –≤—Å–µ–≥–¥–∞ –≤–∏–¥–∏—Ç, —á—Ç–æ —Ä–∞–±–æ—Ç–∞ –∏–¥—ë—Ç –ø–æ –ø–ª–∞–Ω—É. –í–∞–º –Ω–µ –Ω—É–∂–Ω–æ –µ–∑–¥–∏—Ç—å –≤ –æ—Ñ–∏—Å –∏–ª–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å –∫—É—á—É –±—É–º–∞–≥ –≤—Ä—É—á–Ω—É—é!\n\n---\n\nüì∏ <b>–§–æ—Ç–æ–æ—Ç—á—ë—Ç—ã ‚Äî –ö–∞–∫ –†–∞–±–æ—Ç–∞–µ—Ç –ü–æ–º–æ—â–Ω–∏–∫</b>\n\n<b>–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –∫—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ:</b>\n–ù–∞—à–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ —Ñ–æ—Ç–æ–æ—Ç—á—ë—Ç–∞—Ö, –∞–¥—Ä–µ—Å–æ–≤–∞–Ω–Ω—ã–µ –∏–º–µ–Ω–Ω–æ –≤–∞–º. –ï—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å ‚Äî –≤—ã —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∞–µ—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.\n\n<b>üîπ –ß—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤–∞–º –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É –Ω–∞ –æ–±—ä–µ–∫—Ç–µ:</b>\nüîî –°–ø–∏—Å–æ–∫ –Ω—É–∂–Ω—ã—Ö —Ñ–æ—Ç–æ (–∂—É—Ä–Ω–∞–ª —Ä–∞–±–æ—Ç, —Å–≤–∞—Ä–∫–∞, –±–µ—Ç–æ–Ω, —Ç–µ—Ö–Ω–∏–∫–∞ –∏ —Ç.–¥.) –≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö.\n\n<b>üîπ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –æ—Ç—á—ë—Ç —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:</b>\n- –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –ø–æ –æ—Ç—á—ë—Ç—É.\n- –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ –≤ –æ—Ç–≤–µ—Ç–µ, –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ) –∏ –Ω–∞–∂–º–∏—Ç–µ \"–û—Ç–ø—Ä–∞–≤–∏—Ç—å\".\n- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –ø–æ —ç—Ç–æ–º—É –æ—Ç—á—ë—Ç—É.\n\n–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —á—Ç–æ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ—à—ë–ª –¥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞.\n\n---\n\nüõ† <b>–ó–∞–¥–∞—á–∏ ‚Äî –ö–∞–∫ –†–∞–±–æ—Ç–∞–µ—Ç –ü–æ–º–æ—â–Ω–∏–∫</b>\n\n<b>–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á:</b>\n–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–Ω–æ—Å–∏—Ç –∑–∞–¥–∞—á–∏ –≤ —Ç–∞–±–ª–∏—Ü—É. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è –∏ –ø—Ä–∏—Å—ã–ª–∞–µ—Ç –≤–∞–º –∑–∞–¥–∞—á–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è—à–Ω–∏–π –¥–µ–Ω—å.\n\n<b>üîπ –ß—Ç–æ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤–∞–º –∫–∞–∫ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é:</b>\n- –ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏.\n- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–¥–∞—á–∏:\n  - üî¥ <b>–í—ã—Å–æ–∫–∏–π</b> ‚Äî –≤–∞–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ, –≤–ª–∏—è–µ—Ç –Ω–∞ —Å—Ä–æ–∫–∏ –¥—Ä—É–≥–∏—Ö —Ä–∞–±–æ—Ç.\n  - üü° <b>–°—Ä–µ–¥–Ω–∏–π</b> ‚Äî –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è.\n  - üü¢ <b>–ù–∏–∑–∫–∏–π</b> ‚Äî –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ –∑–∞–¥–∞—á —Å –≤—ã—Å–æ–∫–∏–º –∏ —Å—Ä–µ–¥–Ω–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º.\n\n<b>üîπ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –ø–æ –∑–∞–¥–∞—á–µ:</b>\n- –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–º: <b>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</b> / <b>–ß–∞—Å—Ç–∏—á–Ω–æ</b> / <b>–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ</b>.\n- –ö—Ä–∞—Ç–∫–æ –æ–ø–∏—à–∏—Ç–µ, —á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –∏–ª–∏ –ø–æ—á–µ–º—É –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å.\n\n–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —á—Ç–æ –≤–∞—à –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ—à—ë–ª –¥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞.\n\nüì• –û—Ç–≤–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –æ–±—â–µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è ‚Äî –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ!\n\n---\n\n‚ùì <b>–ü–æ –≤—Å–µ–º –≤–æ–ø—Ä–æ—Å–∞–º –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –≤–∞—à–µ–º—É –º–µ–Ω–µ–¥–∂–µ—Ä—É.</b>`,\n      parse_mode: \"MarkdownV2\"\n    }\n  }];\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /poluchil (–¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–¥–∞—á)\nif (messageText.trim().toLowerCase() === '/poluchil') {\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ reply_to_message –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –æ–Ω–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–¥–∞—á–∞—Ö\n  if (message.reply_to_message && message.reply_to_message.text && \n      (message.reply_to_message.text.includes('–∑–∞–¥–∞—á') || \n       message.reply_to_message.text.includes('–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:') ||\n       message.reply_to_message.text.includes('–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è!'))) {\n    return [{\n      json: {\n        action: \"process_poluchil\",\n        chat_id: chatId,\n        foreman_id: String(chatId),\n        message: `‚úÖ –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ!\n\nüìù **–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç –ø–æ –∑–∞–¥–∞—á–µ:**\n\n–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ:\n\\`\\`\\`—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å\n–≤—ã–ø–æ–ª–Ω–µ–Ω–æ\n–í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ\n\\`\\`\\`\n–∏–ª–∏\n\\`\\`\\`—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å\n—á–∞—Å—Ç–∏—á–Ω–æ\n–ó–∞–ª–∏—Ç–æ 70% —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞\n\\`\\`\\`\n–∏–ª–∏\n\\`\\`\\`—Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å\n–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ\n–ù–µ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤\n\\`\\`\\``\n      }\n    }];\n  } else {\n    // –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞–∫ –æ–±—â–µ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ\n    return [{\n      json: {\n        action: \"process_poluchil\",\n        chat_id: chatId,\n        foreman_id: String(chatId),\n        message: `‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–∏–Ω—è—Ç–æ!\n\nüìù **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ñ–æ—Ä–º–∞—Ç–µ –æ—Ç—á–µ—Ç–æ–≤:**\n\n–î–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ—Ç—á–µ—Ç–∞ –ø–æ –∑–∞–¥–∞—á–µ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–¥–∞—á–µ–π –≤ —Ñ–æ—Ä–º–∞—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –¥–≤—É—Ö —Å—Ç—Ä–æ–∫:\n- –≤—ã–ø–æ–ª–Ω–µ–Ω–æ / —á–∞—Å—Ç–∏—á–Ω–æ / –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ\n- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)\n\n–£–¥–∞—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã! üí™`\n      }\n    }];\n  }\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /prochital (–¥–ª—è —Ñ–æ—Ç–æ-–æ—Ç—á–µ—Ç–æ–≤)\nif (text.trim().toLowerCase() === '/prochital') {\n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ reply_to_message\n  if (message.reply_to_message) {\n    return [{\n      json: {\n        action: 'process_prochital',\n        chatId: chatId,\n        userName: userName,\n        originalMessage: message,\n        isDirectCommand: false\n      }\n    }];\n  } else {\n    // –ï—Å–ª–∏ –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ\n    return [{\n      json: {\n        action: 'process_prochital',\n        chatId: chatId,\n        userName: userName,\n        originalMessage: message,\n        isDirectCommand: true\n      }\n    }];\n  }\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /status\nif (text.trim().toLowerCase() === '/status') {\n  return [{\n    json: {\n      action: 'check_today_status',\n      chatId: chatId,\n      userId: userId,\n      date: today\n    }\n  }];\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /report\nif (text.trim().toLowerCase() === '/report') {\n  return [{\n    json: {\n      action: 'send_report_menu',\n      chatId: chatId,\n      message: `üì∏ **–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –æ—Ç—á–µ—Ç–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏:**\\\\n\\\\n–û—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–æ–º–µ—Ä –Ω—É–∂–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞:\\\\n\\\\n1Ô∏è‚É£ –§–æ—Ç–æ –æ–±—â–µ–≥–æ –∂—É—Ä–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç\\\\n2Ô∏è‚É£ –§–æ—Ç–æ –æ—Ç—á—ë—Ç —Å–≤–∞—Ä–æ—á–Ω—ã—Ö —Ä–∞–±–æ—Ç\\\\n3Ô∏è‚É£ –§–æ—Ç–æ –æ—Ç—á—ë—Ç –±–µ—Ç–æ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç\\\\n4Ô∏è‚É£ –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Ç–µ—Ö–Ω–∏–∫–∏, –º–∞—à–∏–Ω–æ—á–∞—Å—ã\\\\n5Ô∏è‚É£ –§–æ—Ç–æ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\\\\n\\\\n–ù–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ \"1\" –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ –∂—É—Ä–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç.`\n    }\n  }];\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —Ç–∏–ø–∞ –æ—Ç—á–µ—Ç–∞ (—Ü–∏—Ñ—Ä—ã 1-5)\nif (text.match(/^[1-5]$/)) {\n  const reportTypes = {\n    '1': '–§–æ—Ç–æ –æ–±—â–µ–≥–æ –∂—É—Ä–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç',\n    '2': '–§–æ—Ç–æ –æ—Ç—á—ë—Ç —Å–≤–∞—Ä–æ—á–Ω—ã—Ö —Ä–∞–±–æ—Ç',\n    '3': '–§–æ—Ç–æ –æ—Ç—á—ë—Ç –±–µ—Ç–æ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç',\n    '4': '–§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Ç–µ—Ö–Ω–∏–∫–∏, –º–∞—à–∏–Ω–æ—á–∞—Å—ã',\n    '5': '–§–æ—Ç–æ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –±—É—Ö–≥–∞–ª—Ç–µ—Ä—Å–∫–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤'\n  };\n  const selectedType = reportTypes[text];\n  const manualReportId = 'MANUAL_' + Date.now();\n  return [{\n    json: {\n      action: 'send_manual_report_instruction',\n      chatId: chatId,\n      reportType: selectedType,\n      reportId: manualReportId,\n      message: `üì∏ **${selectedType}**\\\\n\\\\nüî∏ ${manualReportId} ${selectedType}\\\\n\\\\n–¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ.\\\\n\\\\n‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é \"–û—Ç–≤–µ—Ç–∏—Ç—å\" –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ!\\\\n\\\\n–ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏.`\n    }\n  }];\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π\nif (message.photo) {\n  if (message.reply_to_message && message.reply_to_message.text) {\n    return [{\n      json: {\n        action: 'process_photo',\n        chatId: chatId,\n        userName: userName,\n        originalMessage: message,\n        replyToMessage: message.reply_to_message\n      }\n    }];\n  } else {\n    return [{\n      json: {\n        action: 'send_error_no_reply',\n        chatId: chatId,\n        message: `‚ùå **–û—à–∏–±–∫–∞!**\\\\n\\\\n‚ö†Ô∏è –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ **–≤ –æ—Ç–≤–µ—Ç** –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º.\\\\n\\\\nüì∏ **–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ:**\\\\n1. –ù–∞–π–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –æ –Ω—É–∂–Ω–æ–º –æ—Ç—á–µ—Ç–µ\\\\n2. –ù–∞–∂–º–∏—Ç–µ ¬´–û—Ç–≤–µ—Ç–∏—Ç—å¬ª –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ\\\\n3. –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ\\\\n\\\\n–ï—Å–ª–∏ –≤—ã –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /report`\n      }\n    }];\n  }\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ (GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç)\nif (message.location) {\n  if (message.reply_to_message && message.reply_to_message.text) {\n    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–µ\n    const replyText = message.reply_to_message.text;\n    if (replyText.includes('üî∏') && (replyText.includes('–§–æ—Ç–æ') || replyText.includes('–æ—Ç—á—ë—Ç') || replyText.includes('MANUAL_'))) {\n      return [{\n        json: {\n          action: 'process_location',\n          chatId: chatId,\n          userName: userName,\n          originalMessage: message,\n          replyToMessage: message.reply_to_message\n        }\n      }];\n    }\n  } else {\n    return [{\n      json: {\n        action: 'send_error_no_reply',\n        chatId: chatId,\n        message: `‚ùå **–û—à–∏–±–∫–∞!**\\\\n\\\\n‚ö†Ô∏è –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ **–≤ –æ—Ç–≤–µ—Ç** –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –æ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–µ.\\\\n\\\\nüìç **–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:**\\\\n1. –ù–∞–π–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º –æ –Ω—É–∂–Ω–æ–º –æ—Ç—á–µ—Ç–µ\\\\n2. –ù–∞–∂–º–∏—Ç–µ ¬´–û—Ç–≤–µ—Ç–∏—Ç—å¬ª –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ\\\\n3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é\\\\n\\\\n–ï—Å–ª–∏ –≤—ã –Ω–µ –ø–æ–ª—É—á–∞–ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–µ–≥–æ–¥–Ω—è, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /report`\n      }\n    }];\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –æ—Ç—á–µ—Ç–æ–≤\nfunction extractProjectInfo(messageText) {\n  const objectMatch = messageText?.match(/\\|\\s*([^,]+),\\s*([^\\n]+)/);\n  return {\n    object: objectMatch ? objectMatch[1].trim() : foremanContext.object || \"–ù–µ —É–∫–∞–∑–∞–Ω\",\n    section: objectMatch ? objectMatch[2].trim() : foremanContext.section || \"–ù–µ —É–∫–∞–∑–∞–Ω\"\n  };\n}\n\nfunction extractTaskIdFromMessage(messageText) {\n  let match = messageText.match(/\\*\\*(ID\\d+)\\*\\*/i);\n  if (match) return match[1];\n  \n  match = messageText.match(/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:\\s*\\n\\s*(ID\\d+)/i);\n  if (match) return match[1];\n  \n  match = messageText.match(/–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:\\s*(ID\\d+)/i);\n  if (match) return match[1];\n  \n  match = messageText.match(/^(ID\\d+)/mi);\n  if (match) return match[1];\n  \n  return null;\n}\n\nfunction extractTaskNameFromMessage(messageText) {\n  let match = messageText.match(/ID\\d+\\s+([^|]+)/i);\n  if (match) return match[1].trim();\n  \n  match = messageText.match(/\\*\\*ID\\d+\\*\\*\\s+([^|]+)/i);\n  return match ? match[1].trim() : null;\n}\n\n// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ –∑–∞–¥–∞—á–∏\nconst replyToMessage = message.reply_to_message?.text || '';\nconst projectInfo = extractProjectInfo(replyToMessage);\nconst isTaskReply = replyToMessage.includes('–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:') && replyToMessage.includes('–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç:');\n\nif (message.text && !message.text.startsWith('/') && isTaskReply) {\n  const lines = text.split('\\n').filter(line => line.trim());\n  const taskId = extractTaskIdFromMessage(replyToMessage);\n  const taskName = extractTaskNameFromMessage(replyToMessage);\n  \n  if (taskId && taskName) {\n    const status = lines[0] ? lines[0].trim().toLowerCase() : '';\n    const comment = lines[1] ? lines.slice(1).join(' ').trim() : '';\n    \n    return [{\n      json: {\n        action: \"check_task_ownership\",\n        chat_id: chatId,\n        taskId: taskId,\n        foremanId: String(chatId),\n        status: status,\n        comment: comment,\n        replyToMessage: replyToMessage,\n        projectInfo: projectInfo,\n        foremanName: foremanContext.foremanName || userName,\n        today: today,\n        time: time\n      }\n    }];\n  } else {\n    return [{\n      json: {\n        action: \"send_command_response\",\n        chat_id: chatId,\n        message: `‚ùå **–û—à–∏–±–∫–∞!**\n        \n        –ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ID –∑–∞–¥–∞—á–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–¥–∞—á–µ–π –∑–∞–Ω–æ–≤–æ.`\n      }\n    }];\n  }\n}\n\n// –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞\nlet reports = [];\nif (message.text && !message.text.startsWith('/')) {\n  const lines = text.split('\\n').filter(line => line.trim());\n  \n  if (text.toLowerCase().includes('–∑–∞–¥–∞—á–∞:') && text.toLowerCase().includes('—Å—Ç–∞—Ç—É—Å:')) {\n    let currentReport = null;\n    let currentField = null;\n    let parsedObject = null;\n    let parsedSection = null;\n    \n    for (let i = 0; i < lines.length; i++) {\n      const line = lines[i].trim();\n      const lowerLine = line.toLowerCase();\n      \n      if (lowerLine.includes('–æ–±—ä–µ–∫—Ç:')) {\n        parsedObject = line.substring(line.toLowerCase().indexOf('–æ–±—ä–µ–∫—Ç:') + 7).trim();\n        continue;\n      }\n      if (lowerLine.includes('—É—á–∞—Å—Ç–æ–∫:')) {\n        parsedSection = line.substring(line.toLowerCase().indexOf('—É—á–∞—Å—Ç–æ–∫:') + 8).trim();\n        continue;\n      }\n      \n      if (lowerLine.includes('–∑–∞–¥–∞—á–∞:')) {\n        if (currentReport && currentReport.–ó–∞–¥–∞—á–∞) {\n          reports.push(currentReport);\n        }\n        currentReport = {\n          \"–î–∞—Ç–∞\": today,\n          \"–í—Ä–µ–º—è\": time,\n          \"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å\": foremanContext.foremanName || userName,\n          \"ID_—á–∞—Ç–∞\": chatId,\n          \"ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è\": chatId,\n          \"–û–±—ä–µ–∫—Ç\": parsedObject || projectInfo.object,\n          \"–£—á–∞—Å—Ç–æ–∫\": parsedSection || projectInfo.section,\n          \"–ó–∞–¥–∞—á–∞\": line.substring(line.toLowerCase().indexOf('–∑–∞–¥–∞—á–∞:') + 7).trim(),\n          \"–°—Ç–∞—Ç—É—Å\": \"–ù–µ —É–∫–∞–∑–∞–Ω\",\n          \"–ü—Ä–æ—Ü–µ–Ω—Ç\": 0,\n          \"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\": \"\",\n          \"–ü—Ä–æ–±–ª–µ–º—ã\": \"\",\n          \"–¢–∏–ø_–æ—Ç—á–µ—Ç–∞\": \"–î–µ—Ç–∞–ª—å–Ω—ã–π\",\n          \"–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞\": `${today} ${time}`\n        };\n        currentField = null;\n      }\n      else if (currentReport) {\n        if (lowerLine.includes('—Å—Ç–∞—Ç—É—Å:')) {\n          const statusValue = line.substring(line.toLowerCase().indexOf('—Å—Ç–∞—Ç—É—Å:') + 7).trim();\n          currentReport[\"–°—Ç–∞—Ç—É—Å\"] = statusValue;\n          if (statusValue.toLowerCase().match(/–≤—ã–ø–æ–ª–Ω(–µ–Ω|–∏–ª|–µ–Ω–æ|–∏–ª–∞|–∏–ª–∏)/) && !statusValue.toLowerCase().includes('–Ω–µ')) {\n            currentReport[\"–ü—Ä–æ—Ü–µ–Ω—Ç\"] = 100;\n          } else if (statusValue.toLowerCase().includes('—á–∞—Å—Ç–∏—á–Ω–æ')) {\n            currentReport[\"–ü—Ä–æ—Ü–µ–Ω—Ç\"] = 50;\n          } else if (statusValue.toLowerCase().match(/–Ω–µ\\s*–≤—ã–ø–æ–ª–Ω/)) {\n            currentReport[\"–ü—Ä–æ—Ü–µ–Ω—Ç\"] = 0;\n          }\n          currentField = null;\n        }\n        else if (lowerLine.includes('–ø—Ä–æ—Ü–µ–Ω—Ç:')) {\n          const percentValue = line.substring(line.toLowerCase().indexOf('–ø—Ä–æ—Ü–µ–Ω—Ç:') + 8).trim();\n          currentReport[\"–ü—Ä–æ—Ü–µ–Ω—Ç\"] = parseInt(percentValue.replace('%', '')) || 0;\n          currentField = null;\n        }\n        else if (lowerLine.includes('–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:')) {\n          currentReport[\"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\"] = line.substring(line.toLowerCase().indexOf('–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:') + 12).trim();\n          currentField = \"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\";\n        }\n        else if (lowerLine.includes('–ø—Ä–æ–±–ª–µ–º—ã:') || lowerLine.includes('–ø—Ä–æ–±–ª–µ–º–∞:')) {\n          const problemIndex = lowerLine.includes('–ø—Ä–æ–±–ª–µ–º—ã:') ? \n            line.toLowerCase().indexOf('–ø—Ä–æ–±–ª–µ–º—ã:') + 9 : \n            line.toLowerCase().indexOf('–ø—Ä–æ–±–ª–µ–º–∞:') + 9;\n          currentReport[\"–ü—Ä–æ–±–ª–µ–º—ã\"] = line.substring(problemIndex).trim();\n          currentField = \"–ü—Ä–æ–±–ª–µ–º—ã\";\n        }\n        else if (currentField && line.trim() && !lowerLine.includes(':')) {\n          currentReport[currentField] += \" \" + line.trim();\n        }\n      }\n    }\n    \n    if (currentReport && currentReport.–ó–∞–¥–∞—á–∞) {\n      reports.push(currentReport);\n    }\n  }\n}\n\nif (reports.length > 0) {\n  return [{\n    json: {\n      action: \"process_report\",\n      chat_id: chatId,\n      reports: reports\n    }\n  }];\n}\n\n// –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–æ, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–ø—Ä–∞–≤–∫—É\nif (!messageText.startsWith('/') && reports.length === 0) {\n  return [{\n    json: {\n      action: \"send_message\",\n      chatId: chatId,\n      message: `‚ùì –ù–µ –ø–æ–Ω–∏–º–∞—é –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.\\n\\n**–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:**\\n/prochital ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø—Ä–æ—á—Ç–µ–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\\n/poluchil ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–¥–∞—á\\n/help ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø—Ä–∞–≤–∫—É\\n\\n–ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å ‚Äî –Ω–∞–ø–∏—à–∏—Ç–µ /help`\n    }\n  }];\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç—á–µ—Ç—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è\nreturn reports.map(report => ({ json: report }));"
      },
      "name": "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -240,
        2016
      ],
      "id": "1ca75005-b92f-4501-abe0-72cf19594a00"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "send_message"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å send_message",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        528,
        368
      ],
      "id": "7e051a7b-7f7c-4808-a1b3-0706a7f8b282"
    },
    {
      "parameters": {
        "chatId": "={{ $json['chatId'] }}",
        "text": "={{ $json['message'] }}",
        "additionalFields": {
          "parse_mode": "HTML"
        }
      },
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1824,
        624
      ],
      "id": "159afe44-77d3-4273-b522-79fd826c73fb",
      "webhookId": "XXX"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "process_prochital"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å prochital",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        528,
        1392
      ],
      "id": "01960928-04a3-4685-845f-bf08c23ce84f"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "mode": "name"
        },
        "options": {}
      },
      "name": "–ß–∏—Ç–∞—Ç—å –ª–∏—Å—Ç –¥–ª—è prochital",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        736,
        1424
      ],
      "id": "d4bd86b4-1045-4b9a-93f0-e468341d926e",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –õ–æ–≥–∏–∫–∞ –∏–∑ lager2 –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ /prochital\nconst items = $input.all();\nconst chatId = String($node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json.chatId);\nconst userName = $node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json.userName;\nconst now = new Date();\nconst readDateTime = now.toLocaleString('ru-RU', {\n  day: '2-digit',\n  month: '2-digit',\n  year: 'numeric',\n  hour: '2-digit',\n  minute: '2-digit'\n});\nconst today = now.toLocaleDateString('ru-RU');\n\n// –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–¥–∞—á–∏ –¥–ª—è —ç—Ç–æ–≥–æ chatId –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ\nconst updates = [];\nlet foundReminders = 0;\nconst reportDetails = [];\n\nitems.forEach((item, index) => {\n  if (index === 0) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫\n  \n  const itemChatId = String(item.json['ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è'] || '').trim();\n  const sent = item.json['–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'];\n  const read = item.json['–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ'];\n  const reminderDateRaw = item.json['–î–∞—Ç–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è'];\n  const reportId = item.json['ID_–æ—Ç—á—ë—Ç–∞'];\n  const reportType = item.json['–¢–∏–ø –æ—Ç—á—ë—Ç–∞'] || item.json['–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞'] || '';\n  \n  if (!reminderDateRaw || !reportId) return;\n  \n  let taskDate;\n  try {\n    if (typeof reminderDateRaw === 'number') {\n      taskDate = new Date((reminderDateRaw - 25569) * 86400 * 1000);\n    } else if (typeof reminderDateRaw === 'string' && reminderDateRaw.includes('.')) {\n      const [day, month, year] = reminderDateRaw.split('.');\n      taskDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    } else {\n      taskDate = new Date(reminderDateRaw);\n    }\n    taskDate.setHours(0, 0, 0, 0);\n  } catch (e) {\n    console.error('Error parsing date:', reminderDateRaw, e);\n    return;\n  }\n  \n  const taskDateStr = taskDate.toLocaleDateString('ru-RU');\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –∫–∞–∫ –≤ lager2\n  if (itemChatId === chatId && taskDateStr === today && sent === '–î–∞' && (!read || read !== '–î–∞')) {\n    const rowIndex = index + 2; // +2 –¥–ª—è Excel\n    foundReminders++;\n    \n    reportDetails.push({\n      reportId: reportId,\n      reportType: reportType\n    });\n    \n    updates.push({\n      json: {\n        values: [['–î–∞', readDateTime]],\n        _rowIndex: rowIndex\n      }\n    });\n  }\n});\n\nconsole.log(`–ù–∞–π–¥–µ–Ω–æ ${foundReminders} –∑–∞–¥–∞—á –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è`);\n\n// –î–æ–±–∞–≤–ª—è–µ–º —Å–≤–æ–¥–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∫–æ–Ω–µ—Ü (–¥–ª—è –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é)\nif (foundReminders > 0 || true) { // –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ–º –¥–ª—è –æ—Ç–≤–µ—Ç–∞\n  updates.push({\n    json: {\n      isProchitalSummary: true,\n      foundReminders: foundReminders,\n      reportDetails: reportDetails,\n      chatId: chatId,\n      readDateTime: readDateTime\n    }\n  });\n}\n\nreturn updates;"
      },
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        896,
        1424
      ],
      "id": "e2bb7c41-ec2c-4b52-860c-d01f22473454"
    },
    {
      "parameters": {
        "conditions": {
          "boolean": [
            {
              "value1": "={{ $json['isProchitalSummary'] }}",
              "value2": true
            }
          ]
        }
      },
      "name": "–§–∏–ª—å—Ç—Ä prochital summary",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1152,
        1264
      ],
      "id": "23c078b5-5b85-4b6e-ad1c-53e559bbf0cc"
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json._rowIndex }}",
              "operation": "isNotEmpty"
            },
            {
              "value1": "={{ $json._rowIndex }}",
              "operation": "larger",
              "value2": 1
            }
          ]
        }
      },
      "name": "–§–∏–ª—å—Ç—Ä –≤–∞–ª–∏–¥–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—á—Ç–µ–Ω–∏—è",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1120,
        1456
      ],
      "id": "d9e9ced3-10ea-4556-b931-93711d1ba180"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ": "={{ $json.values[0][0] }}",
            "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è": "={{ $json.values[0][1] }}",
            "row_number": "={{ $json._rowIndex }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ",
              "displayName": "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "displayName": "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true
            }
          ]
        },
        "options": {}
      },
      "name": "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—á—Ç–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1344,
        1424
      ],
      "id": "652e628f-2ced-437d-afb0-6c651c0349f9",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json.chatId }}",
        "text": "={{ $json['message'] }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ prochital",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1808,
        1312
      ],
      "id": "0c188d50-90fc-451d-a856-5f9745e7b0b6",
      "webhookId": "8d79c01c-7c9a-44d9-890f-faba6cb77712"
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–∞ –¥–ª—è /prochital\nconst summaryData = $input.first();\nif (!summaryData.json.isProchitalSummary) {\n  return [];\n}\n\nconst totalUpdated = summaryData.json.foundReminders || 0;\nconst chatId = summaryData.json.chatId;\nconst readDateTime = summaryData.json.readDateTime;\nconst reportDetails = summaryData.json.reportDetails || [];\nconst dadac = "QXJ0ZW0gQm9pa28uIERhdGFEcml2ZW5jb25zdHJ1Y3Rpb24uaW8";\n\nlet responseMessage;\nlet unuddc = \"ab\".replace(/ /g, '_');\n\nif (totalUpdated > 0) {\n  responseMessage = `‚úÖ **–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è!**\\n\\n`;\n  responseMessage += `üìã –û—Ç–º–µ—á–µ–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏: ${totalUpdated} –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\\n`;\n  responseMessage += `‚è∞ –í—Ä–µ–º—è: ${readDateTime}\\n\\n`;\n  \n  if (reportDetails.length > 0) {\n    responseMessage += `üìù **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç—ã:**\\n`;\n    reportDetails.forEach(detail => {\n      responseMessage += `‚Ä¢ ${detail.reportId} - ${detail.reportType}\\n`;\n    });\n    responseMessage += `\\n`;\n  }\n  \n  responseMessage += `üì∏ **–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç:**\\n`;\n  responseMessage += `1. –ù–∞–π–¥–∏—Ç–µ –Ω—É–∂–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ —á–∞—Ç–µ\\n`;\n  responseMessage += `2. –ù–∞–∂–º–∏—Ç–µ \"–û—Ç–≤–µ—Ç–∏—Ç—å\" –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ\\n`;\n  responseMessage += `3. –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ\\n\\n`;\n  \n  responseMessage += `–•–æ—Ä–æ—à–µ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è üí™`;\n} else {\n  responseMessage = `‚ÑπÔ∏è **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è**\\n\\n`;\n  responseMessage += `–ù–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.\\n\\n`;\n  responseMessage += `–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\\n`;\n  responseMessage += `‚Ä¢ –í—Å–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —É–∂–µ –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ\\n`;\n  responseMessage += `‚Ä¢ –°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\\n`;\n  responseMessage += `‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –µ—â–µ –Ω–µ –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã\\n\\n`;\n  responseMessage += `üìä –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /status –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –≤–∞—à–∏—Ö –æ—Ç—á–µ—Ç–æ–≤.`;\n}\n\nreturn [{\n  json: {\n    message: responseMessage\n  }\n}];"
      },
      "name": "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç prochital",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1344,
        1248
      ],
      "id": "b44c4e0c-b8bd-4c74-95f1-96d591775beb"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "send_error_no_reply"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É no_reply",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        528,
        1200
      ],
      "id": "237239a3-e039-4284-89ce-3605e29b6365"
    },
    {
      "parameters": {
        "chatId": "={{ $json['chatId'] }}",
        "text": "={{ $json['message'] }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "name": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        768,
        1184
      ],
      "id": "0464e41d-7d31-4724-9347-daddbe60d24a",
      "webhookId": "4e3d940f-9988-41ed-aa86-7e9ee575568e"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "check_today_status"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å check_status",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        544,
        816
      ],
      "id": "300a2d06-96b7-41c3-ad32-8aed6d3affa8"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "mode": "name"
        },
        "options": {}
      },
      "name": "–ß–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        768,
        816
      ],
      "id": "cc80f97a-652d-4307-a4e3-13b7bc8e4cb8",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –°–±–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç—á–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞ —Å–µ–≥–æ–¥–Ω—è\nconst chatId = String($node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json.chatId);\nconst today = new Date().toLocaleDateString('ru-RU');\nconst items = $input.all();\nconst userReports = {};\n\nitems.forEach((item, index) => {\n  if (index < 1) return;\n  const itemChatId = String(item.json['ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è'] || '');\n  if (itemChatId !== chatId) return;\n  \n  const reportId = item.json['ID_–æ—Ç—á—ë—Ç–∞'];\n  const reportType = item.json['–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞'] || item.json['–¢–∏–ø –æ—Ç—á—ë—Ç–∞'] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø';\n  const reminderDate = item.json['–î–∞—Ç–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è'];\n  const sent = item.json['–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'];\n  const read = item.json['–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ'];\n  const photoDate = item.json['–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞'];\n  const photoTime = item.json['–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç'];\n  const fileStatus = item.json['–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏'];\n  \n  if (!reportId) return;\n  \n  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∑–∞–ø–∏—Å—å –¥–ª—è –æ—Ç—á–µ—Ç–∞ –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç\n  if (!userReports[reportId]) {\n    userReports[reportId] = {\n      reportId: reportId,\n      reportType: reportType,\n      sent: false,\n      read: false,\n      photos: []\n    };\n  }\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ\n  if (reminderDate) {\n    let taskDate;\n    if (typeof reminderDate === 'number') {\n      taskDate = new Date((reminderDate - 25569) * 86400 * 1000);\n    } else {\n      taskDate = new Date(reminderDate);\n    }\n    const taskDateStr = taskDate.toLocaleDateString('ru-RU');\n    \n    if (taskDateStr === today && sent === '–î–∞') {\n      userReports[reportId].sent = true;\n      if (read === '–î–∞') {\n        userReports[reportId].read = true;\n      }\n    }\n  }\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ\n  if (photoDate === today && fileStatus) {\n    userReports[reportId].photos.push({\n      time: photoTime,\n      status: fileStatus\n    });\n  }\n});\n\n// –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤ –º–∞—Å—Å–∏–≤\nconst reportsArray = Object.values(userReports);\n\nreturn [{\n  json: {\n    userReports: reportsArray,\n    totalReports: reportsArray.length\n  }\n}];"
      },
      "name": "–°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ –ª–∏—Å—Ç—É",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        944,
        816
      ],
      "id": "68028765-2399-4ab1-9f39-e0ee04155311"
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ\nconst summaryItem = $input.first();\nconst chatId = String($node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json.chatId);\nconst userName = $node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json.userName;\nconst today = new Date().toLocaleDateString('ru-RU');\n\nconst summary = {\n  sent: [],\n  read: [],\n  received: [],\n  missing: []\n};\n\nconst reports = summaryItem.json.userReports || [];\n\nreports.forEach(report => {\n  const reportStr = `${report.reportId} ${report.reportType}`;\n  \n  if (report.sent) {\n    summary.sent.push(reportStr);\n    if (report.read) {\n      summary.read.push(reportStr);\n    }\n    if (report.photos.length > 0) {\n      const photoInfo = report.photos.length > 1 ? ` (${report.photos.length} —Ñ–æ—Ç–æ)` : '';\n      summary.received.push(reportStr + photoInfo);\n    } else {\n      summary.missing.push(reportStr);\n    }\n  }\n});\n\nlet message = `üìä **–°—Ç–∞—Ç—É—Å –≤–∞—à–∏—Ö –æ—Ç—á–µ—Ç–æ–≤ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è**\\n\\n`;\nmessage += `üìÖ –î–∞—Ç–∞: ${today}\\n\\n`;\n\nif (summary.sent.length > 0) {\n  message += `üì§ **–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:** ${summary.sent.length}\\n`;\n  \n  if (summary.read.length > 0) {\n    message += `‚úÖ **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –ø—Ä–æ—á—Ç–µ–Ω–∏–µ:** ${summary.read.length}\\n`;\n  } else {\n    message += `‚ö†Ô∏è **–ù–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ:** ${summary.sent.length - summary.read.length}\\n`;\n    message += `üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /prochital –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\\n`;\n  }\n  \n  message += `\\n`;\n  \n  if (summary.received.length > 0) {\n    message += `üì∏ **–ü–æ–ª—É—á–µ–Ω–æ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–æ–≤:** ${summary.received.length}\\n`;\n    summary.received.forEach(report => {\n      message += `   ‚úì ${report}\\n`;\n    });\n  }\n  \n  if (summary.missing.length > 0) {\n    message += `\\n‚ùå **–û–∂–∏–¥–∞—é—Ç—Å—è –æ—Ç—á–µ—Ç—ã:**\\n`;\n    summary.missing.forEach(report => {\n      message += `   ‚Ä¢ ${report}\\n`;\n    });\n    message += `\\nüí° –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å —Ñ–æ—Ç–æ.`;\n  } else {\n    message += `\\n‚ú® **–í—Å–µ –æ—Ç—á–µ—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã! –û—Ç–ª–∏—á–Ω–∞—è —Ä–∞–±–æ—Ç–∞!**`;\n  }\n} else {\n  message += `‚ÑπÔ∏è –ù–∞ —Å–µ–≥–æ–¥–Ω—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.\\n\\n`;\n  message += `–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:\\n`;\n  message += `‚Ä¢ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã\\n`;\n  message += `‚Ä¢ –°–µ–≥–æ–¥–Ω—è –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤\\n\\n`;\n  message += `–ï—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ, —á—Ç–æ —ç—Ç–æ –æ—à–∏–±–∫–∞, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É.`;\n}\n\nreturn [{\n  json: {\n    action: 'send_message',\n    chatId: chatId,\n    message: message\n  }\n}];"
      },
      "name": "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1152,
        816
      ],
      "id": "73e72974-d2c2-4b11-9624-1fad66e72d52"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "send_report_menu"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å send_report_menu",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        544,
        672
      ],
      "id": "137fd85c-39e7-42af-b840-67585de3789d"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "send_manual_report_instruction"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å manual_report",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        544,
        528
      ],
      "id": "590b8f15-470e-45cd-9b19-a8ce302cf50c"
    },
    {
      "parameters": {
        "jsCode": "// –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∑–∞–ø—Ä–æ—Å–æ–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏\n\nreturn [{\n  json: {\n    action: 'send_message',\n    chatId: $json.chatId,\n    message:  `üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∂—É—Ä–Ω–∞–ª –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è!\\n\\n–í–∞—à Telegram ID: ${$json.chatId}\\n\\nüìù –î–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, —É–∫–∞–∑–∞–≤:\\n<pre>–ò–º—è: –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤\n–ö–æ–º–ø–∞–Ω–∏—è: –°—Ç—Ä–æ–π–ú–æ–Ω—Ç–∞–∂</pre>\\n\\n‚úèÔ∏è –ü—Ä–∏–º–µ—Ä –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è:\\n<pre>–ò–º—è: \n–ö–æ–º–ø–∞–Ω–∏—è: </pre>\\n\\n‚ö†Ô∏è <b>–í–∞–∂–Ω–æ:</b> –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–≤–µ—Ç—å—Ç–µ –∏–º–µ–Ω–Ω–æ –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ!`\n\n  }\n}];"
      },
      "name": "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1392,
        176
      ],
      "id": "8b5a8df8-468a-4ffd-b6c5-2411f54a7838"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.action }}",
              "value2": "complete_registration"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å complete_registration1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        528,
        1008
      ],
      "id": "105eaf24-cadf-4a87-bf9b-61e5e2530e72"
    },
    {
      "parameters": {
        "jsCode": "// –î–æ–±–∞–≤–ª—è–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏\nconst now = new Date();\nconst registrationDate = now.toLocaleDateString('ru-RU');\nconst registrationTime = now.toLocaleString('ru-RU');\n\nreturn [{\n  json: {\n    ...($json || {}),\n    registrationDate,\n    registrationTime\n  }\n}];"
      },
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        768,
        992
      ],
      "id": "1cf10792-d039-49c5-aeb2-f8806c5822f4"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 1001730935,
          "mode": "list",
          "cachedResultName": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug/edit#gid=1001730935"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–∞—Ç–∞": "={{ $json.registrationTime }}",
            "Telegram ID": "={{ $json.userId }}",
            "–ò–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è": "={{ $json.proforemanName }}",
            "–ö–æ–º–ø–∞–Ω–∏—è": "={{ $json.company }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Telegram ID",
              "displayName": "Telegram ID",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–∞—Ç–∞",
              "displayName": "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–∞—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–ò–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
              "displayName": "–ò–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–ö–æ–º–ø–∞–Ω–∏—è",
              "displayName": "–ö–æ–º–ø–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ]
        },
        "options": {}
      },
      "name": "–ó–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        976,
        992
      ],
      "id": "0c4a953b-36f8-4c13-a2af-31ea41cf249d",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤—Ö–æ–¥—è—â–µ–≥–æ –ø–æ—Ç–æ–∫–∞\nconst inputData = $input.first().json;\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è\nconst proforemanName = inputData['–ò–º—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è'] || inputData.proforemanName || '–ù–µ —É–∫–∞–∑–∞–Ω–æ';\nconst company = inputData['–ö–æ–º–ø–∞–Ω–∏—è'] || inputData.company || '–ù–µ —É–∫–∞–∑–∞–Ω–∞';\nconst telegramId = inputData['Telegram ID'] || inputData.userId || inputData.chatId || '–ù–µ —É–∫–∞–∑–∞–Ω';\nconst registrationDate = inputData['–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –¥–∞—Ç–∞'] || inputData.registrationTime || new Date().toLocaleString('ru-RU');\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Å–∏–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\nconst message = `‚úÖ <b>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!</b>\n\nüë§ <b>–ò–º—è:</b> ${proforemanName}\nüè¢ <b>–ö–æ–º–ø–∞–Ω–∏—è:</b> ${company}\nüÜî <b>Telegram ID:</b> ${telegramId}\nüìÖ <b>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:</b> ${registrationDate}\n\n‚ú® –¢–µ–ø–µ—Ä—å –≤—ã —Å–º–æ–∂–µ—Ç–µ:\n‚Ä¢ –ü–æ–ª—É—á–∞—Ç—å –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∑–∞–¥–∞—á–∏ –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –Ω–∞ –¥–µ–Ω—å\n‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á\n‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–æ—Ç–æ –æ—Ç—á–µ—Ç—ã –∫ –∑–∞–¥–∞—á–∞–º\n\nüöÄ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –¥–æ–∂–¥–∏—Ç–µ—Å—å –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è —Å–æ —Å–ø–∏—Å–∫–æ–º –æ—Ç—á—ë—Ç–æ–≤ –æ—Ç –≤–∞—à–µ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–µ –æ–±—ã—á–Ω–æ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ –Ω–∞—á–∞–ª–µ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è!\n\\n\n‚ùì –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞–∂–º–∏—Ç–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ /help\n`;\n\nreturn [{\n  json: {\n    chatId: telegramId,\n    message: message,\n    parse_mode: 'HTML'\n  }\n}];"
      },
      "name": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1184,
        992
      ],
      "id": "f796c593-c9b5-4648-9db4-a338556d33e8"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "={{ $json.parse_mode }}"
        }
      },
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ2",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1360,
        992
      ],
      "id": "d142b806-e6fc-4d18-8fe0-d9abaaab3cc3",
      "webhookId": "b4d6fd80-8694-4e9b-abe5-86ddb964aa7a"
    },
    {
      "parameters": {
        "jsCode": "// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –ø–æ ID_–∑–∞–¥–∞—á–∏\nconst allItems = $input.all();\n\nif (!allItems || allItems.length === 0) {\n  console.error('–ù–µ—Ç —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏');\n  return [];\n}\n\n// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –ø–æ taskId\nconst groupedByTask = {};\n\nallItems.forEach(item => {\n  const data = item.json;\n  if (!data || !data.reportData || !data.reportData.taskId) {\n    console.warn('–ü—Ä–æ–ø—É—â–µ–Ω —Ñ–∞–π–ª –±–µ–∑ taskId');\n    return;\n  }\n  \n  const taskId = data.reportData.taskId;\n  \n  if (!groupedByTask[taskId]) {\n    groupedByTask[taskId] = {\n      taskId: taskId,\n      files: [],\n      reportData: data.reportData, // –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –±–µ—Ä–µ–º –∏–∑ –ø–µ—Ä–≤–æ–≥–æ —Ñ–∞–π–ª–∞\n      messageData: data.messageData\n    };\n  }\n  \n  // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–∞–π–ª –≤ –≥—Ä—É–ø–ø—É\n  groupedByTask[taskId].files.push({\n    fileData: data.fileData,\n    reportData: data.reportData,\n    messageData: data.messageData\n  });\n});\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≥—Ä—É–ø–ø—ã –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–µ items\nconst results = Object.values(groupedByTask).map(group => {\n  console.log(`–ì—Ä—É–ø–ø–∞ –¥–ª—è taskId ${group.taskId}: ${group.files.length} —Ñ–∞–π–ª–æ–≤`);\n  \n  return {\n    json: {\n      taskId: group.taskId,\n      filesGroup: group.files,\n      reportData: group.reportData,\n      messageData: group.messageData,\n      filesCount: group.files.length\n    }\n  };\n});\n\nreturn results;"
      },
      "name": "–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø–æ –∑–∞–¥–∞—á–µ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2096,
        1856
      ],
      "id": "2dc715f2-5621-4920-9c37-6c7fa02ff57c"
    },
    {
      "parameters": {
        "mode": "multiplex"
      },
      "name": "Merge lookup and grouped files",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 1,
      "position": [
        2416,
        1840
      ],
      "id": "f798d7b5-b2b2-45e4-a219-b437911af421"
    },
    {
      "parameters": {
        "mode": "multiplex"
      },
      "name": "Merge for confirmation",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 1,
      "position": [
        3232,
        1728
      ],
      "id": "1554d6f6-41a3-4d17-b280-01ad51756429"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\nconst data = $json;\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö\nif (!data || !data.confirmationData) {\n  console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è');\n  return [];\n}\n\nconst confirmData = data.confirmationData;\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏\nlet operationText = '';\nif (confirmData._newFilesCount !== undefined) {\n  // –≠—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ\n  operationText = `–î–æ–±–∞–≤–ª–µ–Ω–æ ${confirmData._newFilesCount} ${confirmData._newFilesCount === 1 ? '—Ñ–∞–π–ª' : '—Ñ–∞–π–ª–∞(–æ–≤)'} –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞—á–µ.`;\n} else {\n  // –≠—Ç–æ –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å\n  operationText = `–°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å —Å ${confirmData._filesCount} ${confirmData._filesCount === 1 ? '—Ñ–∞–π–ª–æ–º' : '—Ñ–∞–π–ª–∞–º–∏'}.`;\n}\n\nconsole.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:', {\n  taskId: confirmData._taskId,\n  filesCount: confirmData._filesCount,\n  operation: confirmData._newFilesCount !== undefined ? 'update' : 'create'\n});\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\nreturn [{\n  json: {\n    chatId: confirmData._chatId,\n    taskId: confirmData._taskId,\n    originalMessageId: confirmData._originalMessageId,\n    filesCount: confirmData._filesCount,\n    newFilesCount: confirmData._newFilesCount,\n    rowData: {\n      'ID_–æ—Ç—á—ë—Ç–∞': confirmData.ID_–æ—Ç—á—ë—Ç–∞,\n      '–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞': confirmData['–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞'],\n      '–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç': confirmData['–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç'],\n      '–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏': confirmData['–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏'],\n      '–ò–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤': confirmData._fileNames\n    },\n    operationText: operationText,\n    updateSuccess: true\n  }\n}];"
      },
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3392,
        1728
      ],
      "id": "303c936e-cb79-45d6-811e-265f3a9363b7"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "process_photo"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_photo3",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        512,
        1728
      ],
      "id": "a6584f1a-6fb0-472b-abdf-32cddd291376"
    },
    {
      "parameters": {
        "jsCode": "// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ç–æ —Å —Ñ–æ–∫—É—Å–æ–º –Ω–∞ ID –∑–∞–¥–∞—á–∏\nconst input = $node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json;\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\nif (!input || !input.originalMessage) {\n  return [{\n    json: {\n      error: true,\n      errorMessage: '–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è',\n      chatId: input?.chatId || 'unknown'\n    }\n  }];\n}\n\nconst message = input.originalMessage;\nconst chatId = String(message.chat?.id || '');\nconst caption = message.caption || '';\nconst replyTo = input.replyToMessage;\nconst ddc_editor = \"Pipeline: https://datadrivenconstruction.io/ by Artem Boiko\";\nconst userName = (message.from?.first_name || '') + ' ' + (message.from?.last_name || '');\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–æ—Ç–æ\nif (!message.photo || !Array.isArray(message.photo) || message.photo.length === 0) {\n  return [{\n    json: {\n      error: true,\n      errorMessage: '–ù–µ—Ç —Ñ–æ—Ç–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏',\n      chatId: chatId,\n      originalMessage: message\n    }\n  }];\n}\n\n// –ü–∞—Ä—Å–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç—á–µ—Ç–µ - –í–ê–ñ–ù–û: ID_–∑–∞–¥–∞—á–∏\nlet reportType = '–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∏–ø';\nlet taskId = null; // ID_–∑–∞–¥–∞—á–∏\n\nif (replyTo?.text) {\n  const replyText = replyTo.text;\n  \n  // –ü–∞—Ä—Å–∏–Ω–≥ ID –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞: üî∏ ID4 –§–æ—Ç–æ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö...\n  const idMatch = replyText.match(/üî∏\\s*(ID\\d+)\\s+(.+?)(?=\\n|$)/i);\n  if (idMatch) {\n    taskId = idMatch[1]; // –≠—Ç–æ –∏ –µ—Å—Ç—å ID_–∑–∞–¥–∞—á–∏\n    reportType = idMatch[2].trim();\n  }\n  \n  // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Ä—É—á–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤\n  if (!taskId) {\n    const manualMatch = replyText.match(/(MANUAL_\\d+)/i);\n    if (manualMatch) {\n      taskId = manualMatch[1]; // ID_–∑–∞–¥–∞—á–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞\n      const typeMatch = replyText.match(/üì∏\\s*\\*\\*(.+?)\\*\\*/);\n      if (typeMatch) {\n        reportType = typeMatch[1];\n      }\n    }\n  }\n}\n\n// –í–∞–ª–∏–¥–∞—Ü–∏—è ID_–∑–∞–¥–∞—á–∏\nif (!taskId) {\n  console.error('Could not parse task ID from:', replyTo?.text);\n  return [{\n    json: {\n      error: true,\n      errorMessage: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ID –∑–∞–¥–∞—á–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º.',\n      chatId: chatId,\n      originalMessage: message\n    }\n  }];\n}\n\n// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–æ—Ç–æ\nconst now = new Date();\nconst dateStr = now.toLocaleDateString('ru-RU');\nconst timeStr = now.toLocaleString('ru-RU');\n\n// –ë–µ—Ä–µ–º —Å–∞–º—ã–π –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä —Ñ–æ—Ç–æ (–ø–æ—Å–ª–µ–¥–Ω–∏–π –≤ –º–∞—Å—Å–∏–≤–µ)\nconst largestPhoto = message.photo[message.photo.length - 1];\nconst fileId = largestPhoto.file_id;\nconst fileSize = largestPhoto.file_size || 0;\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞\nif (fileSize > 20 * 1024 * 1024) {\n  return [{\n    json: {\n      error: true,\n      errorMessage: `–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π: ${(fileSize / 1024 / 1024).toFixed(2)} –ú–ë. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä 20 –ú–ë.`,\n      chatId: chatId,\n      originalMessage: message\n    }\n  }];\n}\n\n// –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞\nconst timestamp = Date.now();\nconst fileName = `${chatId}_${taskId}_${message.message_id}_${timestamp}.jpg`;\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º Media Group ID –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —Ñ–∞–π–ª–æ–≤ –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏\nconst mediaGroupId = message.media_group_id || `single_${message.message_id}`;\n\nconsole.log(`–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ç–æ: ${fileName}, ID_–∑–∞–¥–∞—á–∏: ${taskId}, Media Group: ${mediaGroupId}`);\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–¥–Ω–æ–≥–æ —Ñ–æ—Ç–æ\nreturn [{\n  json: {\n    chatId: chatId,\n    userName: userName,\n    reportType: reportType,\n    taskId: taskId, // ID_–∑–∞–¥–∞—á–∏ - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–ª—é—á –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏\n    caption: caption,\n    date: dateStr,\n    time: timeStr,\n    originalMessage: message,\n    replyToMessageId: replyTo?.message_id || '',\n    fileId: fileId,\n    fileName: fileName,\n    fileSize: fileSize,\n    mediaGroupId: mediaGroupId, // –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è\n    messageId: message.message_id,\n    timestamp: timestamp\n  }\n}];"
      },
      "name": "–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ4",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        736,
        1712
      ],
      "id": "6969a7df-4bb6-4d06-8b8a-2efda54a6566"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.error }}",
              "value2": "true"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        928,
        1712
      ],
      "id": "37d22930-e889-4153-aaf3-fa884fdb7cf4"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "‚ùå **–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ñ–æ—Ç–æ!**\n\n{{ $json.errorMessage || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞' }}\n\nüì∏ **–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**\n1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–æ—Ç–æ (–º–∞–∫—Å–∏–º—É–º 20 –ú–ë)\n2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –µ—â–µ —Ä–∞–∑\n\n–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É.",
        "additionalFields": {
          "parse_mode": "Markdown",
          "reply_to_message_id": "={{ $json.originalMessage?.message_id }}"
        }
      },
      "name": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ñ–æ—Ç–æ4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1120,
        1696
      ],
      "id": "bfe99d99-89f9-478c-94ad-129bf513c2e8",
      "webhookId": "caa76ffe-a249-4fc3-81cf-396f0bfa9ed2"
    },
    {
      "parameters": {
        "resource": "file",
        "fileId": "={{ $json.fileId }}"
      },
      "name": "–ü–æ–ª—É—á–∏—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1120,
        1840
      ],
      "id": "9fe3e668-cc51-44da-adeb-aca94baf6f48",
      "webhookId": "facb38e6-fcf3-4883-9513-7b1b9d1ac55f"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ Object.keys($binary || {}).length }}",
              "operation": "larger",
              "value2": "0"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞4",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1312,
        1840
      ],
      "id": "014807f8-8e8f-4888-8296-b274d6bcb0bd"
    },
    {
      "parameters": {
        "name": "={{ $json.fileName }}",
        "driveId": {
          "__rl": true,
          "mode": "list",
          "value": "My Drive"
        },
        "folderId": {
          "__rl": true,
          "mode": "list",
          "value": "root",
          "cachedResultName": "/ (Root folder)"
        },
        "options": {}
      },
      "name": "–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Google Drive4",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1472,
        1712
      ],
      "id": "a1c2478e-8069-4085-b654-4aa169ab022d"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—É\nconst photoData = $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ4'].json;\nconst driveFile = $json;\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\nif (!photoData) {\n  console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ');\n  return [];\n}\n\n// –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∏ —Å—Å—ã–ª–∫—É\nlet fileLink = '';\nlet fileStatus = '';\n\nif (driveFile?.id) {\n  // –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Drive\n  if (driveFile.webViewLink) {\n    fileLink = driveFile.webViewLink;\n  } else if (driveFile.webContentLink) {\n    fileLink = driveFile.webContentLink;\n  } else {\n    fileLink = `https://drive.google.com/file/d/${driveFile.id}/view`;\n  }\n  fileStatus = 'uploaded';\n} else {\n  // –§–∞–π–ª –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ–º Telegram ID\n  fileLink = `telegram://file_id/${photoData.fileId || ''}`;\n  fileStatus = 'telegram_only';\n}\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞\nreturn [{\n  json: {\n    // –î–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞\n    fileData: {\n      fileName: photoData.fileName || '',\n      fileLink: fileLink,\n      fileId: photoData.fileId || '',\n      fileSize: photoData.fileSize || 0,\n      fileStatus: fileStatus,\n      messageId: photoData.messageId || ''\n    },\n    // –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç–∞\n    reportData: {\n      taskId: photoData.taskId || '', // ID_–∑–∞–¥–∞—á–∏ - –≥–ª–∞–≤–Ω—ã–π –∫–ª—é—á\n      chatId: photoData.chatId || '',\n      userName: photoData.userName || '',\n      reportType: photoData.reportType || '–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∏–ø',\n      date: photoData.date || new Date().toLocaleDateString('ru-RU'),\n      time: photoData.time || new Date().toLocaleString('ru-RU'),\n      caption: photoData.caption || '',\n      originalMessageId: photoData.messageId || ''\n    },\n    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏–∏\n    messageData: {\n      mediaGroupId: photoData.mediaGroupId || '',\n      timestamp: photoData.timestamp || Date.now()\n    }\n  }\n}];"
      },
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏5",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1728,
        1712
      ],
      "id": "5dce7fbf-cd31-40e4-8edc-4e48a6c481f9"
    },
    {
      "parameters": {
        "jsCode": "// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–ª—É—á–∞—è, –∫–æ–≥–¥–∞ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ñ–∞–π–ª\nconst photoData = $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ4'].json;\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö\nif (!photoData) {\n  console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–∫–∏');\n  return [];\n}\n\n// –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å Telegram file_id\nreturn [{\n  json: {\n    // –î–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞\n    fileData: {\n      fileName: photoData.fileName || '',\n      fileLink: `telegram://file_id/${photoData.fileId || ''}`,\n      fileId: photoData.fileId || '',\n      fileSize: photoData.fileSize || 0,\n      fileStatus: 'telegram_only',\n      messageId: photoData.messageId || ''\n    },\n    // –û–±—â–∏–µ –¥–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç–∞\n    reportData: {\n      taskId: photoData.taskId || '', // ID_–∑–∞–¥–∞—á–∏\n      chatId: photoData.chatId || '',\n      userName: photoData.userName || '',\n      reportType: photoData.reportType || '–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∏–ø',\n      date: photoData.date || new Date().toLocaleDateString('ru-RU'),\n      time: photoData.time || new Date().toLocaleString('ru-RU'),\n      caption: photoData.caption || '',\n      originalMessageId: photoData.messageId || ''\n    },\n    // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ–æ–±—â–µ–Ω–∏–∏\n    messageData: {\n      mediaGroupId: photoData.mediaGroupId || '',\n      timestamp: photoData.timestamp || Date.now()\n    }\n  }\n}];"
      },
      "name": "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è4",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1600,
        1856
      ],
      "id": "260d48d6-737b-4325-b202-dc04d70491e6"
    },
    {
      "parameters": {},
      "name": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ—Ç–æ–∫–∏ —Ñ–∞–π–ª–æ–≤2",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 1,
      "position": [
        1904,
        1856
      ],
      "id": "d13d3566-e763-4bf8-b1dd-cc2e094ab293"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 1296052809,
          "mode": "list",
          "cachedResultName": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug/edit#gid=1296052809"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "ID_–æ—Ç—á—ë—Ç–∞",
              "lookupValue": "={{ $json.taskId }}"
            }
          ]
        },
        "options": {}
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–¥–∞—á—É1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        2256,
        1728
      ],
      "alwaysOutputData": true,
      "id": "76213fa7-f50b-4e99-8dd3-fcbfd4735918",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.lookup?.length || 0 }}",
              "operation": "larger"
            }
          ]
        }
      },
      "name": "–°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∑–∞–¥–∞—á–∞?1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        2576,
        1840
      ],
      "id": "3567414e-eadb-454d-a98a-f26999679cfd"
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏\nconst input = $json;\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö\nif (!input || !input.filesGroup) {\n  console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ filesGroup');\n  return [];\n}\n\nconst filesGroup = input.filesGroup;\nconst reportData = input.reportData;\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\nif (!reportData.taskId || filesGroup.length === 0) {\n  console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç taskId –∏–ª–∏ —Ñ–∞–π–ª—ã');\n  return [];\n}\n\n// –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ –≤ –≥—Ä—É–ø–ø–µ\nconst fileNames = [];\nconst fileLinks = [];\nconst fileIds = [];\nlet totalSize = 0;\nconst allCaptions = [];\nconst mediaGroupIds = new Set();\n\n// –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Ñ–∞–π–ª–∞–º –≤ –≥—Ä—É–ø–ø–µ\nfilesGroup.forEach(file => {\n  if (file && file.fileData) {\n    // –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è —Ñ–∞–π–ª–∞\n    if (file.fileData.fileName) {\n      fileNames.push(file.fileData.fileName);\n    }\n    \n    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª\n    if (file.fileData.fileLink) {\n      fileLinks.push(file.fileData.fileLink);\n    }\n    \n    // –î–æ–±–∞–≤–ª—è–µ–º Telegram File ID\n    if (file.fileData.fileId) {\n      fileIds.push(file.fileData.fileId);\n    }\n    \n    // –°—É–º–º–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä\n    totalSize += file.fileData.fileSize || 0;\n    \n    // –°–æ–±–∏—Ä–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏\n    if (file.reportData?.caption) {\n      allCaptions.push(file.reportData.caption);\n    }\n    \n    // –°–æ–±–∏—Ä–∞–µ–º Media Group IDs\n    if (file.messageData?.mediaGroupId) {\n      mediaGroupIds.add(file.messageData.mediaGroupId);\n    }\n  }\n});\n\n// –û–±—ä–µ–¥–∏–Ω—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏\nconst uniqueCaptions = [...new Set(allCaptions)];\nconst combinedComment = uniqueCaptions.join('; ');\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç–∞—Ç—É—Å\nconst filesCount = fileNames.length;\nconst statusText = filesCount === 1 ? \n  '–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Drive' : \n  `–í—Å–µ ${filesCount} —Ñ–∞–π–ª–∞(–æ–≤) –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ Drive`;\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü—É\n// Internal: Artem Boiko - DataDrivenconstruction.io\nconst result = {\n  'ID_–æ—Ç—á—ë—Ç–∞': reportData.taskId, // ID_–∑–∞–¥–∞—á–∏ - –≥–ª–∞–≤–Ω—ã–π –∫–ª—é—á\n  'ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è': reportData.chatId ? String(reportData.chatId) : '',\n  '–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å': reportData.userName || '',\n  '–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞': reportData.date || new Date().toLocaleDateString('ru-RU'),\n  '–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç': reportData.time || new Date().toLocaleString('ru-RU'),\n  '–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞': reportData.reportType || '–ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–∏–ø',\n  '–ò–º—è —Ñ–∞–π–ª–∞': fileNames.join(', '),\n  '–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª': fileLinks.join(', '),\n  'Telegram File ID': fileIds.join(', '),\n  '–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–±–∞–π—Ç)': String(totalSize),\n  '–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏': statusText,\n  '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤': String(filesCount),\n  '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π': combinedComment,\n  'Media Group ID': Array.from(mediaGroupIds).join(', ')\n};\n\n// –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\nconst confirmationData = {\n  '_chatId': reportData.chatId || '',\n  '_taskId': reportData.taskId || '',\n  '_originalMessageId': reportData.originalMessageId || '',\n  '_filesCount': filesCount,\n  '_fileNames': fileNames.join(', '),\n  'ID_–æ—Ç—á—ë—Ç–∞': result['ID_–æ—Ç—á—ë—Ç–∞'],\n  '–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞': result['–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞'],  \n  '–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç': result['–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç'],\n  '–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏': result['–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏']\n};\n\nconsole.log(`–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –¥–ª—è ID_–∑–∞–¥–∞—á–∏ ${reportData.taskId}:`, {\n  filesCount: filesCount,\n  totalSize: totalSize,\n  fileNames: fileNames\n});\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–¥–∏–Ω item —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏\nreturn [{\n  json: {\n    sheetsData: result,\n    confirmationData: confirmationData\n  }\n}];"
      },
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2800,
        1856
      ],
      "id": "17d71c3f-d021-450e-b3a0-2a11d9536610"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "–ò–º—è —Ñ–∞–π–ª–∞": "={{ $json.updateData['–ò–º—è —Ñ–∞–π–ª–∞'] }}",
            "–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª": "={{ $json.updateData['–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª'] }}",
            "Telegram File ID": "={{ $json.updateData['Telegram File ID'] }}",
            "–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–±–∞–π—Ç)": "={{ $json.updateData['–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–±–∞–π—Ç)'] }}",
            "–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏": "={{ $json.updateData['–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏'] }}",
            "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤": "={{ $json.updateData['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤'] }}",
            "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": "={{ $json.updateData['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] }}",
            "Media Group ID": "={{ $json.updateData['Media Group ID'] }}",
            "–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç": "={{ $json.updateData['–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç'] }}"
          }
        },
        "options": {}
      },
      "name": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ2",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        3024,
        1632
      ],
      "id": "65c5393d-7669-461f-8cc2-f9774886a57e",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "ID_–æ—Ç—á—ë—Ç–∞": "={{ $json.sheetsData['ID_–æ—Ç—á—ë—Ç–∞'] }}",
            "–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞": "={{ $json.sheetsData['–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞'] }}",
            "–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç": "={{ $json.sheetsData['–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç'] }}",
            "–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞": "={{ $json.sheetsData['–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞'] }}",
            "–ò–º—è —Ñ–∞–π–ª–∞": "={{ $json.sheetsData['–ò–º—è —Ñ–∞–π–ª–∞'] }}",
            "–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª": "={{ $json.sheetsData['–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª'] }}",
            "–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏": "={{ $json.sheetsData['–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏'] }}",
            "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤": "={{ $json.sheetsData['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤'] }}",
            "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": "={{ $json.sheetsData['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] }}"
          },
          "matchingColumns": [
            "ID_–æ—Ç—á—ë—Ç–∞"
          ],
          "schema": [
            {
              "id": "ID_–æ—Ç—á—ë—Ç–∞",
              "displayName": "ID_–æ—Ç—á—ë—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",
              "displayName": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–¢–∏–ø –æ—Ç—á—ë—Ç–∞",
              "displayName": "–¢–∏–ø –æ—Ç—á—ë—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–î–∞—Ç–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "displayName": "–î–∞—Ç–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "displayName": "–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
              "displayName": "ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ö–æ–º–ø–∞–Ω–∏—è",
              "displayName": "–ö–æ–º–ø–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "displayName": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "displayName": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ",
              "displayName": "–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø—Ä–æ—á–∏—Ç–∞–Ω–æ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "displayName": "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç",
              "displayName": "–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞",
              "displayName": "–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–ò–º—è —Ñ–∞–π–ª–∞",
              "displayName": "–ò–º—è —Ñ–∞–π–ª–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª",
              "displayName": "–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
              "displayName": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤",
              "displayName": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏",
              "displayName": "–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞",
              "displayName": "–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "name": "–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É –æ—Ç—á–µ—Ç–æ–≤1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        3072,
        1856
      ],
      "id": "690b20bc-a673-4a6f-81ac-c2d98bdb224d",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "=‚úÖ {{ $json.filesCount > 1 ? $json.filesCount + ' —Ñ–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã' : '–§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω–æ' }}!  \nüìã ID –∑–∞–¥–∞—á–∏: {{ $json.taskId }}  \nüïê –í—Ä–µ–º—è: {{ $json.rowData['–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç'] }}  \nüìé –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ –≤ –∑–∞–¥–∞—á–µ: {{ $json.rowData['–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏'].match(/\\d+/)?.[0] || $json.filesCount }}  \nüíæ –°—Ç–∞—Ç—É—Å: –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ —Ç–∞–±–ª–∏—Ü—É \n{{ $json.operationText }}  \n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –æ—Ç—á–µ—Ç–∞!",
        "replyMarkup": "=",
        "forceReply": {},
        "replyKeyboardOptions": {},
        "replyKeyboardRemove": {},
        "additionalFields": {
          "parse_mode": "Markdown",
          "reply_to_message_id": "={{ $json.originalMessageId }}"
        }
      },
      "name": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ4",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        3584,
        1728
      ],
      "id": "35f26b00-256f-4a48-8196-8993fee86ce5",
      "webhookId": "1bfa29ad-d706-4c4c-b5a5-0c1b1851a18c"
    },
    {
      "parameters": {
        "chatId": "={{ $json.foreman_id }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ poluchil",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        2144,
        2624
      ],
      "id": "2b545fe1-2022-476c-9cf4-53e1d9411d6c",
      "webhookId": "86812008-0328-4a88-ade9-d59ed3b581c0"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json[\"action\"] }}",
              "value2": "check_task_ownership"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∑–∞–¥–∞—á–∏1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        528,
        2288
      ],
      "id": "cd9713e8-b566-4921-86cf-63ec2d5f709f"
    },
    {
      "parameters": {
        "sheetId": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
        "range": "–ó–∞–¥–∞—á–∏!A:N",
        "options": {}
      },
      "name": "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 2,
      "position": [
        752,
        2272
      ],
      "id": "bd08336f-1d3a-4be0-be55-9742db32339a",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —É–∑–ª–æ–≤\nconst checkData = $node[\"–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\"].json;\nconst allTasks = $input.all();\n\nconst taskId = checkData.taskId;\nconst foremanId = checkData.foremanId;\nconst status = checkData.status;\nconst comment = checkData.comment;\nconst replyToMessage = checkData.replyToMessage;\nconst projectInfo = checkData.projectInfo;\nconst foremanName = checkData.foremanName;\nconst today = checkData.today;\nconst time = checkData.time;\nconst chatId = checkData.chat_id;\n\n// –ò—â–µ–º –∑–∞–¥–∞—á—É —Å –¥–∞–Ω–Ω—ã–º ID\nlet taskFound = false;\nlet taskBelongsToForeman = false;\nlet actualTask = null;\nlet actualForemanName = null;\n\nfor (const item of allTasks) {\n  const currentTaskId = item.json['ID_–∑–∞–¥–∞—á–∏'];\n  const currentForemanId = String(item.json['ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è']).trim();\n  \n  if (currentTaskId && currentTaskId.toUpperCase() === taskId.toUpperCase()) {\n    taskFound = true;\n    actualTask = item.json;\n    \n    if (currentForemanId === String(foremanId)) {\n      taskBelongsToForeman = true;\n      break;\n    } else {\n      actualForemanName = item.json['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'];\n    }\n  }\n}\n\n// –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤–æ–æ–±—â–µ\nif (!taskFound) {\n  return [{\n    json: {\n      action: \"send_command_response\",\n      chat_id: chatId,\n      message: `‚ùå **–û—à–∏–±–∫–∞!**\\n\\n–ó–∞–¥–∞—á–∞ —Å ID **${taskId}** –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º–µ.\\n\\nüìã –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å ID –∑–∞–¥–∞—á–∏.`\n    }\n  }];\n}\n\n// –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞, –Ω–æ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –¥—Ä—É–≥–æ–º—É –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é\nif (!taskBelongsToForeman) {\n  return [{\n    json: {\n      action: \"send_command_response\",\n      chat_id: chatId,\n      message: `‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ!**\\n\\n–ó–∞–¥–∞—á–∞ **${taskId}** –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –≤–∞—à–µ–º—É ID.\\n–≠—Ç–∞ –∑–∞–¥–∞—á–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é: **${actualForemanName || '–î—Ä—É–≥–æ–π –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'}**`\n    }\n  }];\n}\n\n// –ü–µ—Ä–µ–¥–∞—ë–º —Å—Ç–∞—Ç—É—Å –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π\nconst finalStatus = status || \"–ù–µ —É–∫–∞–∑–∞–Ω\";\n\n// –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏\nconst taskName = actualTask['–ó–∞–¥–∞—á–∞'] || `–ó–∞–¥–∞—á–∞ ${taskId}`;\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º –æ–±—ä–µ–∫—Ç –æ—Ç—á–µ—Ç–∞\nconst report = {\n  \"ID_–∑–∞–¥–∞—á–∏\": taskId,\n  \"–î–∞—Ç–∞\": today,\n  \"–í—Ä–µ–º—è\": time,\n  \"–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å\": foremanName || actualTask['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'],\n  \"ID_—á–∞—Ç–∞\": chatId,\n  \"ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è\": chatId,\n  \"–û–±—ä–µ–∫—Ç\": actualTask['–û–±—ä–µ–∫—Ç'] || projectInfo.object,\n  \"–£—á–∞—Å—Ç–æ–∫\": actualTask['–£—á–∞—Å—Ç–æ–∫'] || projectInfo.section,\n  \"–ó–∞–¥–∞—á–∞\": taskName,\n  \"–°—Ç–∞—Ç—É—Å\": finalStatus,\n  \"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\": comment || \"–ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è\",\n  \"–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞\": `${today} ${time}`,\n  \"–ü—Ä–æ—Ü–µ–Ω—Ç\": \"\",\n  \"–ü—Ä–æ–±–ª–µ–º—ã\": \"\",\n  \"–¢–∏–ø_–æ—Ç—á–µ—Ç–∞\": \"–ü–æ ID\"\n};\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç—á–µ—Ç –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏\nreturn [{\n  json: {\n    action: \"process_report\",\n    chat_id: chatId,\n    reports: [report]\n  }\n}];\n"
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ID1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        896,
        2272
      ],
      "id": "e9a32697-d483-4fd6-a341-410c8ab3da16"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json[\"action\"] }}",
              "value2": "process_report"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_report1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1120,
        2448
      ],
      "id": "62f665b0-c083-4ddd-b27f-542615f30db6"
    },
    {
      "parameters": {
        "jsCode": "// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—á–µ—Ç–æ–≤ –∏–∑ action process_report\nconst data = $input.first().json;\nif (data.action === 'process_report' && data.reports) {\n  return data.reports.map(report => ({ json: report }));\n}\n\n// –ò–Ω–∞—á–µ –ø–µ—Ä–µ–¥–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –µ—Å—Ç—å –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏\nreturn $input.all();"
      },
      "name": "–ò–∑–≤–ª–µ—á—å –æ—Ç—á–µ—Ç—ã1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1328,
        2432
      ],
      "id": "9a6af018-cd63-4d92-8bb3-66bf630c7812"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 1720309130,
          "mode": "list",
          "cachedResultName": "–ó–∞–¥–∞—á–∏",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug/edit#gid=1720309130"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "–°—Ç–∞—Ç—É—Å": "={{ $json[\"–°—Ç–∞—Ç—É—Å\"] }}",
            "ID_–∑–∞–¥–∞—á–∏": "={{ $json[\"ID_–∑–∞–¥–∞—á–∏\"] }}",
            "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π": "={{ $json[\"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\"] }}",
            "–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞": "={{ $json[\"–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞\"] }}"
          },
          "matchingColumns": [
            "ID_–∑–∞–¥–∞—á–∏"
          ],
          "schema": [
            {
              "id": "ID_–∑–∞–¥–∞—á–∏",
              "displayName": "ID_–∑–∞–¥–∞—á–∏",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",
              "displayName": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–î–∞—Ç–∞",
              "displayName": "–î–∞—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "displayName": "–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ó–∞–¥–∞—á–∞",
              "displayName": "–ó–∞–¥–∞—á–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–û–±—ä–µ–∫—Ç",
              "displayName": "–û–±—ä–µ–∫—Ç",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–£—á–∞—Å—Ç–æ–∫",
              "displayName": "–£—á–∞—Å—Ç–æ–∫",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ID_–ó–∞–¥–∞—á–∏",
              "displayName": "ID_–ó–∞–¥–∞—á–∏",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",
              "displayName": "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
              "displayName": "ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ö–æ–º–ø–∞–Ω–∏—è",
              "displayName": "–ö–æ–º–ø–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "displayName": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
              "displayName": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ",
              "displayName": "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è",
              "displayName": "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–°—Ç–∞—Ç—É—Å",
              "displayName": "–°—Ç–∞—Ç—É—Å",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
              "displayName": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞",
              "displayName": "–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1520,
        2432
      ],
      "id": "a92d8392-5941-4d1e-969d-180fdb965f12",
      "name": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é\nconst reports = $input.all();\nconst reportsByForeman = {};\n\nreports.forEach(item => {\n  const report = item.json;\n  const foremanId = report.ID_—á–∞—Ç–∞ || report[\"ID_—á–∞—Ç–∞\"];\n  \n  if (!reportsByForeman[foremanId]) {\n    reportsByForeman[foremanId] = {\n      chatId: foremanId,\n      foremanName: report.–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å,\n      date: report.–î–∞—Ç–∞,\n      time: report.–í—Ä–µ–º—è,\n      object: report.–û–±—ä–µ–∫—Ç,\n      section: report.–£—á–∞—Å—Ç–æ–∫,\n      reports: []\n    };\n  }\n  \n  reportsByForeman[foremanId].reports.push({\n    id: report.ID_–∑–∞–¥–∞—á–∏ || \"\",\n    task: report.–ó–∞–¥–∞—á–∞,\n    status: report.–°—Ç–∞—Ç—É—Å,\n    percent: report.–ü—Ä–æ—Ü–µ–Ω—Ç,\n    comment: report.–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π,\n    problems: report.–ü—Ä–æ–±–ª–µ–º—ã,\n    type: report.–¢–∏–ø_–æ—Ç—á–µ—Ç–∞ || \"–û–±—â–∏–π\"\n  });\n});\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\nreturn Object.values(reportsByForeman).map(data => {\n  let message = `‚úÖ **–û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω!**\\n`;\n  \n  if (data.reports.length === 1) {\n    const report = data.reports[0];\n    if (report.id) {\n      message += `üÜî ID –∑–∞–¥–∞—á–∏: ${report.id}\\n`;\n    }\n    message += `üìä –°—Ç–∞—Ç—É—Å: ${report.status}\\n`;\n\n    if (report.comment) {\n      message += `üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${report.comment}\\n`;\n    }\n    if (report.problems) {\n      message += `‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã: ${report.problems}\\n`;\n    }\n  } else {\n    message += `üìã **–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –æ—Ç—á–µ—Ç–æ–≤: ${data.reports.length}**\\n\\n`;\n    data.reports.forEach((report, index) => {\n      const idPrefix = report.id ? `[${report.id}] ` : \"\";\n      message += `${index + 1}. ${idPrefix}${report.task}\\n`;\n      message += `   –°—Ç–∞—Ç—É—Å: ${report.status}`;\n      if (report.percent !== undefined && report.percent > 0) {\n        message += ` (${report.percent}%)`;\n      }\n      message += `\\n`;\n    });\n  }\n  \n  message += `\\n–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç—á–µ—Ç! –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è üôãüèª‚Äç‚ôÇÔ∏è`;\n  \n  return {\n    json: {\n      chat_id: data.chatId,\n      message: message\n    }\n  };\n});"
      },
      "name": "–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1728,
        2432
      ],
      "id": "c161cf69-9647-419d-bf16-9ecbbeea5b30"
    },
    {
      "parameters": {
        "chatId": "={{ $node[\"–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\"].json.chat_id }}",
        "text": "={{ $json[\"message\"] }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "name": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1936,
        2432
      ],
      "id": "80e232bd-7ee2-45e1-8c56-23ee64a65024",
      "webhookId": "86812008-0328-4a88-ade9-d59ed3b581c0"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json[\"action\"] }}",
              "value2": "process_poluchil"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ poluchil1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1120,
        2656
      ],
      "id": "3252d07e-0f4b-4161-a8ac-4f667b3f43a7"
    },
    {
      "parameters": {
        "sheetId": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
        "range": "–ó–∞–¥–∞—á–∏!A:R",
        "options": {}
      },
      "name": "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è1",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 2,
      "position": [
        1344,
        2640
      ],
      "id": "a1f7d0af-d8aa-403e-93d2-5fe56ccb7371",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst chatId = String($node[\"–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\"].json.chat_id);\nconst foremanId = String($node[\"–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\"].json.foreman_id || chatId);\nconst now = new Date();\nconst readDateTime = now.toLocaleString('ru-RU', {\n  day: '2-digit',\n  month: '2-digit',\n  year: 'numeric',\n  hour: '2-digit',\n  minute: '2-digit'\n});\nconst today = now.toLocaleDateString('ru-RU');\n\n// –§–∏–ª—å—Ç—Ä—É–µ–º –∑–∞–¥–∞—á–∏ –¥–ª—è —ç—Ç–æ–≥–æ chatId –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ\nconst updates = [];\nlet rowIndex = 1; // –ù–∞—á–∏–Ω–∞–µ–º —Å 1, —Ç.–∫. –ø–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞ - –∑–∞–≥–æ–ª–æ–≤–∫–∏\n\nitems.forEach((item) => {\n  rowIndex++; // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏\n  \n  const serial = item.json['–î–∞—Ç–∞'];\n  let taskDate;\n  if (serial) {\n    if (typeof serial === 'number') {\n      taskDate = new Date((serial - 25569) * 86400 * 1000).toLocaleDateString('ru-RU');\n    } else if (typeof serial === 'string' && serial.includes('.')) {\n      const [day, month, year] = serial.split('.');\n      taskDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day)).toLocaleDateString('ru-RU');\n    } else {\n      taskDate = new Date(serial).toLocaleDateString('ru-RU');\n    }\n  } else {\n    return;\n  }\n  \n  const itemChatId = String(item.json['ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è']).trim();\n  const sent = item.json['–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'];\n  const read = item.json['–ü—Ä–æ—á–∏—Ç–∞–Ω–æ'];\n  let unu_ddc = \"ab\".replace(/ /g, '_');\n  \n  if (itemChatId === foremanId && taskDate === today && sent === '–î–∞' && (!read || read !== '–î–∞')) {\n    updates.push({\n      json: {\n        values: [['–î–∞', readDateTime]],\n        _rowIndex: rowIndex\n      }\n    });\n  }\n});\n\nconsole.log(`–ù–∞–π–¥–µ–Ω–æ ${updates.length} –∑–∞–¥–∞—á –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è`);\nreturn updates;"
      },
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1552,
        2720
      ],
      "id": "62498ebb-4ab9-42ad-a1a8-ab771e259be3"
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json._rowIndex }}",
              "operation": "isNotEmpty"
            },
            {
              "value1": "={{ $json._rowIndex }}",
              "operation": "larger",
              "value2": 1
            }
          ]
        }
      },
      "name": "–§–∏–ª—å—Ç—Ä –≤–∞–ª–∏–¥–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—á—Ç–µ–Ω–∏—è1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1744,
        2640
      ],
      "id": "d2de0d94-8243-474a-b2ef-676d1fc83f14"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": 1720309130,
          "mode": "list",
          "cachedResultName": "–ó–∞–¥–∞—á–∏",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug/edit#gid=1720309130"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "row_number": "={{ $json._rowIndex }}",
            "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ": "={{ $json.values[0][0] }}",
            "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è": "={{ $json.values[0][1] }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "ID_–∑–∞–¥–∞—á–∏",
              "displayName": "ID_–∑–∞–¥–∞—á–∏",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",
              "displayName": "–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–î–∞—Ç–∞",
              "displayName": "–î–∞—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "displayName": "–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ó–∞–¥–∞—á–∞",
              "displayName": "–ó–∞–¥–∞—á–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–û–±—ä–µ–∫—Ç",
              "displayName": "–û–±—ä–µ–∫—Ç",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–£—á–∞—Å—Ç–æ–∫",
              "displayName": "–£—á–∞—Å—Ç–æ–∫",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ID_–ó–∞–¥–∞—á–∏",
              "displayName": "ID_–ó–∞–¥–∞—á–∏",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",
              "displayName": "–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
              "displayName": "ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ö–æ–º–ø–∞–Ω–∏—è",
              "displayName": "–ö–æ–º–ø–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "displayName": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
              "displayName": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ",
              "displayName": "–ü—Ä–æ—á–∏—Ç–∞–Ω–æ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è",
              "displayName": "–í—Ä–µ–º—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "–°—Ç–∞—Ç—É—Å",
              "displayName": "–°—Ç–∞—Ç—É—Å",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
              "displayName": "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞",
              "displayName": "–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1936,
        2624
      ],
      "id": "861fc3a7-8c4f-4125-aef9-c01561819661",
      "name": "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—á—Ç–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ1",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json[\"action\"] }}",
              "value2": "send_command_response"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1120,
        2096
      ],
      "id": "8b0e7f83-1aed-4c71-ba27-461503c0a072"
    },
    {
      "parameters": {
        "chatId": "={{ $json[\"chat_id\"] }}",
        "text": "={{ $json[\"message\"] }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1392,
        2080
      ],
      "id": "945852e2-65a7-4ba6-b0d4-ae28f30d493a",
      "webhookId": "a7c690e3-fb37-4ef5-be90-cb47a78b94b1"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json[\"action\"] }}",
              "value2": "send_report_form"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1120,
        2272
      ],
      "id": "60b25b1a-236c-4ae3-a86a-e721138ff7f7"
    },
    {
      "parameters": {
        "chatId": "={{ $json[\"chat_id\"] }}",
        "text": "={{ $json[\"message\"] }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –æ—Ç—á–µ—Ç–∞1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1328,
        2256
      ],
      "id": "e9c0d7c8-8e35-4039-93af-a2094c7d637f",
      "webhookId": "4e5fca96-c3d0-41de-ae37-fb2ad000c8e9"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "mode": "name"
        },
        "filtersUI": {
          "values": [
            {
              "lookupColumn": "ID_–æ—Ç—á—ë—Ç–∞",
              "lookupValue": "={{ $json.taskId }}"
            }
          ]
        },
        "options": {}
      },
      "name": "–ù–∞–π—Ç–∏ –∑–∞–¥–∞—á—É –¥–ª—è GPS",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1136,
        3136
      ],
      "alwaysOutputData": true,
      "id": "4f98cc96-a1ae-4808-a457-210ced54a26c",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $items().length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "name": "–ó–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1328,
        3136
      ],
      "id": "ab660d77-4593-4374-8948-659a73cd6487"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã": "={{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.coordinatesText }}",
            "–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É": "={{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.mapLink }}",
            "–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è GPS": "={{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.time }}",
            "row_number": "={{ $json._rowNumber || $json.row_number || 2 }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã",
              "displayName": "GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É",
              "displayName": "–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞—Ä—Ç—É",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è GPS",
              "displayName": "–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è GPS",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true
            }
          ]
        },
        "options": {}
      },
      "name": "–û–±–Ω–æ–≤–∏—Ç—å GPS –≤ —Ç–∞–±–ª–∏—Ü–µ",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        1520,
        3120
      ],
      "id": "e69a1091-de0b-4653-94b8-ceda24dcb4e7",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.chatId }}",
        "text": "=‚úÖ **GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —É—Å–ø–µ—à–Ω–æ –ø–æ–ª—É—á–µ–Ω—ã!**\n\nüìã ID –∑–∞–¥–∞—á–∏: {{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.taskId }}\nüìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: {{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.coordinatesText }}\nüó∫Ô∏è [–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ]({{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.mapLink }})\nüïê –í—Ä–µ–º—è: {{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.time }}\nüíæ –°—Ç–∞—Ç—É—Å: GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫ –æ—Ç—á–µ—Ç—É\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏!",
        "additionalFields": {
          "parse_mode": "Markdown",
          "reply_to_message_id": "={{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.messageId }}"
        }
      },
      "name": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ GPS",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1712,
        3120
      ],
      "id": "baeb81e0-6a0d-4a5e-94bc-d39351f7092c",
      "webhookId": "gps-confirmation-webhook"
    },
    {
      "parameters": {
        "chatId": "={{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.chatId }}",
        "text": "=‚ùå **–û—à–∏–±–∫–∞!**\n\n‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω –æ—Ç—á–µ—Ç —Å ID: {{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.taskId }}\n\nüì∏ –°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ –¥–ª—è —ç—Ç–æ–≥–æ –æ—Ç—á–µ—Ç–∞, –∞ –∑–∞—Ç–µ–º –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.\n\n**–ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π:**\n1. –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π\n2. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ç–æ, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Ç–æ –∂–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π",
        "additionalFields": {
          "parse_mode": "Markdown",
          "reply_to_message_id": "={{ $node['–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1'].json.messageId }}"
        }
      },
      "name": "–û—à–∏–±–∫–∞ - –∑–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1520,
        3264
      ],
      "id": "3cf9ddd3-1826-45ab-864f-5caee99e0e42",
      "webhookId": "task-not-found-webhook"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json['action'] }}",
              "value2": "process_location"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_location2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        608,
        3024
      ],
      "id": "2d615c13-3594-4081-8cf1-ecc84b0640f5"
    },
    {
      "parameters": {
        "jsCode": "\n// –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç–æ–≤\nconst input = $node['–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ'].json;\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö\nif (!input || !input.originalMessage) {\n  return [{\n    json: {\n      error: true,\n      errorMessage: '–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è',\n      chatId: input?.chatId || 'unknown'\n    }\n  }];\n}\n\nconst message = input.originalMessage;\nconst chatId = String(message.chat?.id || '');\nconst replyTo = input.replyToMessage;\nconst userName = (message.from?.first_name || '') + ' ' + (message.from?.last_name || '');\nconst ddc_editor = \"Pipeline: https://datadrivenconstruction.io/ by Artem Boiko\";\n\n// –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏\nif (!message.location) {\n  return [{\n    json: {\n      error: true,\n      errorMessage: '–ù–µ—Ç –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏',\n      chatId: chatId,\n      originalMessage: message\n    }\n  }];\n}\n\nconst location = message.location;\nconst latitude = location.latitude;\nconst longitude = location.longitude;\n\n// –ü–∞—Ä—Å–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ç—á–µ—Ç–µ - –í–ê–ñ–ù–û: ID_–∑–∞–¥–∞—á–∏\nlet taskId = null; // ID_–∑–∞–¥–∞—á–∏\n\nif (replyTo?.text) {\n  const replyText = replyTo.text;\n  \n  // –ü–∞—Ä—Å–∏–Ω–≥ ID –∏–∑ —Ñ–æ—Ä–º–∞—Ç–∞: üî∏ ID4 –§–æ—Ç–æ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö...\n  const idMatch = replyText.match(/üî∏\\s*(ID\\d+)\\s+(.+?)(?=\\n|$)/i);\n  if (idMatch) {\n    taskId = idMatch[1]; // –≠—Ç–æ –∏ –µ—Å—Ç—å ID_–∑–∞–¥–∞—á–∏\n  }\n  \n  // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–ª—è —Ä—É—á–Ω—ã—Ö –æ—Ç—á–µ—Ç–æ–≤\n  if (!taskId) {\n    const manualMatch = replyText.match(/(MANUAL_\\d+)/i);\n    if (manualMatch) {\n      taskId = manualMatch[1]; // ID_–∑–∞–¥–∞—á–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞\n    }\n  }\n}\n\n// –í–∞–ª–∏–¥–∞—Ü–∏—è ID_–∑–∞–¥–∞—á–∏\nif (!taskId) {\n  console.error('Could not parse task ID from:', replyTo?.text);\n  return [{\n    json: {\n      error: true,\n      errorMessage: '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å ID –∑–∞–¥–∞—á–∏. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º.',\n      chatId: chatId,\n      originalMessage: message\n    }\n  }];\n}\n\n// Abdatad update –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é \nconst now = new Date();\nconst dateStr = now.toLocaleDateString('ru-RU');\nconst timeStr = now.toLocaleString('ru-RU');\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞—Ä—Ç—É –∏ —Ç–µ–∫—Å—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\nconst mapLink = `https://maps.google.com/maps?q=${latitude},${longitude}`;\nconst coordinatesText = `${latitude}, ${longitude}`;\n\nconsole.log(`–û–±—Ä–∞–±–æ—Ç–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –¥–ª—è ID_–∑–∞–¥–∞—á–∏: ${taskId}, –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${latitude}, ${longitude}`);\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç\nreturn [{\n  json: {\n    chatId: chatId,\n    userName: userName,\n    taskId: taskId, // ID_–∑–∞–¥–∞—á–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\n    latitude: latitude,\n    longitude: longitude,\n    coordinatesText: coordinatesText,\n    mapLink: mapLink,\n    date: dateStr,\n    time: timeStr,\n    originalMessage: message,\n    replyToMessageId: replyTo?.message_id || '',\n    messageId: message.message_id\n  }\n}];"
      },
      "name": "–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        784,
        3008
      ],
      "id": "7e6e45db-0026-449f-ae51-f8c40ff40c34"
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.error }}",
              "value2": "true"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        944,
        3008
      ],
      "id": "4e9a0fc1-88da-4b44-8d59-347ea65607f8"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "‚ùå **–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏!**\n\n{{ $json.errorMessage || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞' }}\n\nüìç **–ß—Ç–æ –¥–µ–ª–∞—Ç—å:**\n1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç–µ –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º\n2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–µ–æ–ª–æ–∫–∞—Ü–∏—é –µ—â–µ —Ä–∞–∑\n\n–ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É.",
        "additionalFields": {
          "parse_mode": "Markdown",
          "reply_to_message_id": "={{ $json.originalMessage?.message_id }}"
        }
      },
      "name": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        1136,
        2960
      ],
      "id": "6e6c662a-ff1e-43d7-a4ae-962e0c6bd03d",
      "webhookId": "a7fd744e-295d-4cab-b249-6901330ab5fd"
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $items().length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "name": "–ï—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -976,
        1488
      ],
      "id": "6e8de07f-485d-4ec2-aea6-a2f8fa60393a"
    },
    {
      "parameters": {
        "jsCode": "// –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\nconst allMessages = $input.all();\n\n// –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è\nconst now = new Date();\nconst sentDateTime = now.toLocaleString('ru-RU', {\n  day: '2-digit',\n  month: '2-digit',\n  year: 'numeric',\n  hour: '2-digit',\n  minute: '2-digit'\n});\n\n// –°–æ–∑–¥–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏\nconst updates = [];\nconst processedRows = new Set();\n\n// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è - –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ, –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ\nallMessages.forEach(msg => {\n  // –î–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n  if (msg.json.isGreeting === true && msg.json.rowIndexes) {\n    const rowIndexes = msg.json.rowIndexes || [];\n    rowIndexes.forEach(rowIndex => {\n      if (rowIndex && !isNaN(rowIndex) && !processedRows.has(rowIndex)) {\n        processedRows.add(rowIndex);\n        updates.push({\n          json: {\n            values: [[\"–î–∞\", sentDateTime, \"1\"]], // –ù–∞—á–∞–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ = 1\n            _rowIndex: Number(rowIndex)\n          }\n        });\n      }\n    });\n  }\n  \n  // –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\n  if (msg.json.isReminder === true && msg.json.rowIndex) {\n    const rowIndex = msg.json.rowIndex;\n    const count = msg.json.count || 1;\n    if (rowIndex && !isNaN(rowIndex) && !processedRows.has(rowIndex)) {\n      processedRows.add(rowIndex);\n      updates.push({\n        json: {\n          values: [[\"–î–∞\", sentDateTime, String(count)]],\n          _rowIndex: Number(rowIndex)\n        }\n      });\n    }\n  }\n});\n\nconsole.log(`–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ ${updates.length} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π`);\nreturn updates.length > 0 ? updates : [];"
      },
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -576,
        1472
      ],
      "id": "8ffc4ec2-185e-4943-bfe7-339f2a3946f8"
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $items().length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "name": "–ï—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -432,
        1472
      ],
      "id": "7bf75eb8-587c-4cd3-9f88-edb273578f60"
    },
    {
      "parameters": {},
      "name": "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -720,
        1552
      ],
      "id": "4808bf47-8dee-4086-bc83-d576d43c3c4a"
    },
    {
      "parameters": {},
      "name": "–ù–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -272,
        1600
      ],
      "id": "a56f0e88-906a-41f8-aed0-d3d01f666535"
    },
    {
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É - –§–æ—Ç–æ",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        -1712,
        1488
      ],
      "id": "e3a17300-3650-4c68-8dfb-67008a486f0d"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "mode": "name"
        },
        "options": {}
      },
      "name": "–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –∂—É—Ä–Ω–∞–ª–∞",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -1472,
        1488
      ],
      "id": "e73524ef-064d-4aa0-a818-f689fb146eb2",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–∏—Å–∫ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–µ–∫—É—â–µ–≥–æ –∏ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –≤–∫–ª—é—á–∞—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ\nconst items = $input.all();\nconst now = new Date();\nconst todayStr = now.toLocaleDateString('ru-RU');\nconst executorsToNotify = {};\nconst reminderMessages = [];\n\n// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —á–∞—Å—ã –∏ –º–∏–Ω—É—Ç—ã\nconst currentHours = now.getHours();\nconst currentMinutes = now.getMinutes();\nconst currentSeconds = now.getSeconds();\nconst currentTimeInMinutes = currentHours * 60 + currentMinutes;\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏\nfunction parseSentDate(sentDateStr) {\n  if (!sentDateStr || sentDateStr.trim() === '') return null;\n  try {\n    const [datePart, timePart] = sentDateStr.split(', ');\n    const [day, month, year] = datePart.split('.');\n    const [hours, minutes] = timePart.split(':');\n    return new Date(parseInt(year), parseInt(month) - 1, parseInt(day), parseInt(hours), parseInt(minutes));\n  } catch (e) {\n    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏:', sentDateStr, e);\n    return null;\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞\nfunction parseInterval(intervalStr) {\n  if (!intervalStr || intervalStr.trim() === '') return 0;\n  try {\n    const [hours, minutes] = intervalStr.split(':').map(Number);\n    return (hours || 0) * 60 * 60 * 1000 + (minutes || 0) * 60 * 1000;\n  } catch (e) {\n    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞:', intervalStr, e);\n    return 0;\n  }\n}\n\n// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ\nconsole.log('='.repeat(50));\nconsole.log(`–ü–†–û–í–ï–†–ö–ê –í–†–ï–ú–ï–ù–ò (–§–û–¢–û –ñ–£–†–ù–ê–õ)`);\nconsole.log(`–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: ${now.toLocaleString('ru-RU')}`);\nconsole.log(`–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${currentHours}:${currentMinutes.toString().padStart(2, '0')}:${currentSeconds.toString().padStart(2, '0')}`);\nconsole.log(`–ú–∏–Ω—É—Ç –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–Ω—è: ${currentTimeInMinutes}`);\nconsole.log(`–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏: ${items.length - 1}`);\nconsole.log('='.repeat(50));\n\n// –°—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\nlet todayCount = 0;\nlet pastTimeCount = 0;\nlet currentTimeCount = 0;\nlet notSentCount = 0;\nlet toSendNewCount = 0;\nlet toSendReminderCount = 0;\n\nitems.forEach((item, index) => {\n  if (index === 0) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫\n  \n  const executorId = String(item.json['ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è'] || '');\n  const executorName = item.json['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'] || '';\n  const reminderDateRaw = item.json['–î–∞—Ç–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è'];\n  const reminderTimeRaw = item.json['–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è'];\n  const sent = item.json['–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'];\n  const sentDateStr = item.json['–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è'];\n  const reportId = item.json['ID_–æ—Ç—á—ë—Ç–∞'];\n  const reportType = item.json['–¢–∏–ø –æ—Ç—á—ë—Ç–∞'] || item.json['–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞'] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø';\n  const reportDate = item.json['–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞'];\n  const intervalMs = parseInterval(item.json['–° –∫–∞–∫–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –µ—Å–ª–∏ –Ω–µ—Ç –æ—Ç—á—ë—Ç–∞']);\n  const oldCount = parseInt(item.json['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π'] || '0', 10);\n  \n  if (!executorId || !reminderDateRaw || !reportId || !executorName || reminderTimeRaw === undefined) {\n    return;\n  }\n  \n  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É\n  let reminderDate;\n  try {\n    if (typeof reminderDateRaw === 'number') {\n      reminderDate = new Date((reminderDateRaw - 25569) * 86400 * 1000);\n    } else if (typeof reminderDateRaw === 'string' && reminderDateRaw.includes('.')) {\n      const [day, month, year] = reminderDateRaw.split('.');\n      reminderDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    } else {\n      reminderDate = new Date(reminderDateRaw);\n    }\n    reminderDate.setHours(0, 0, 0, 0);\n  } catch (e) {\n    console.error(`  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${index + 2}:`, e);\n    return;\n  }\n  \n  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—Ä–µ–º—è –∏–∑ Excel —Ñ–æ—Ä–º–∞—Ç–∞\n  let reminderHours, reminderMinutes;\n  try {\n    if (typeof reminderTimeRaw === 'number') {\n      const totalMinutes = Math.round(reminderTimeRaw * 24 * 60);\n      reminderHours = Math.floor(totalMinutes / 60);\n      reminderMinutes = totalMinutes % 60;\n    } else if (typeof reminderTimeRaw === 'string') {\n      const cleanTime = reminderTimeRaw.trim();\n      \n      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤—Ä–µ–º–µ–Ω–∏ (–±–µ—Ä–µ–º –ø–µ—Ä–≤–æ–µ)\n      if (cleanTime.includes(' ')) {\n        const firstTime = cleanTime.split(' ')[0];\n        if (/^\\d{1,2}:\\d{2}$/.test(firstTime)) {\n          const [h, m] = firstTime.split(':');\n          reminderHours = parseInt(h);\n          reminderMinutes = parseInt(m);\n        } else {\n          reminderHours = parseInt(firstTime);\n          reminderMinutes = 0;\n        }\n      } else if (/^\\d{1,2}:\\d{2}$/.test(cleanTime)) {\n        const [h, m] = cleanTime.split(':');\n        reminderHours = parseInt(h);\n        reminderMinutes = parseInt(m);\n      } else if (/^\\d{1,2}:\\d{2}:\\d{2}$/.test(cleanTime)) {\n        const [h, m] = cleanTime.split(':');\n        reminderHours = parseInt(h);\n        reminderMinutes = parseInt(m);\n      } else if (cleanTime.includes('AM') || cleanTime.includes('PM')) {\n        const timeParts = cleanTime.replace(/[AP]M/i, '').trim().split(':');\n        reminderHours = parseInt(timeParts[0]);\n        reminderMinutes = parseInt(timeParts[1] || '0');\n        if (cleanTime.toUpperCase().includes('PM') && reminderHours < 12) {\n          reminderHours += 12;\n        } else if (cleanTime.toUpperCase().includes('AM') && reminderHours === 12) {\n          reminderHours = 0;\n        }\n      } else {\n        console.error(`  ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${index + 2}:`, reminderTimeRaw);\n        return;\n      }\n    } else {\n      console.error(`  ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${index + 2}:`, typeof reminderTimeRaw, reminderTimeRaw);\n      return;\n    }\n  } catch (e) {\n    console.error(`  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${index + 2}:`, e);\n    return;\n  }\n  \n  const reminderTimeInMinutes = reminderHours * 60 + reminderMinutes;\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  const isToday = reminderDate.getTime() === today.getTime();\n  \n  const isTimeNowOrPast = reminderTimeInMinutes <= currentTimeInMinutes;\n  const notSent = !sent || sent.toString().trim() === '' || sent !== '–î–∞';\n  const noSentDate = !sentDateStr || sentDateStr.toString().trim() === '';\n  const isNotSent = notSent && noSentDate;\n  const noReport = !reportDate || reportDate.toString().trim() === '';\n  \n  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏\n  if (isToday) {\n    todayCount++;\n    if (isTimeNowOrPast) {\n      if (reminderTimeInMinutes === currentTimeInMinutes) {\n        currentTimeCount++;\n      } else {\n        pastTimeCount++;\n      }\n    }\n    if (isNotSent) notSentCount++;\n  }\n  \n  // –õ–æ–≥–∏–∫–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\n  if (isToday && isTimeNowOrPast && isNotSent && noReport) {\n    toSendNewCount++;\n    \n    if (!executorsToNotify[executorId]) {\n      executorsToNotify[executorId] = {\n        chatId: executorId,\n        executorName: executorName,\n        reports: [],\n        rowIndexes: []\n      };\n    }\n    \n    executorsToNotify[executorId].reports.push({ \n      reportId: reportId, \n      reportType: reportType,\n      rowIndex: index + 2,\n      reminderTime: `${reminderHours}:${reminderMinutes.toString().padStart(2, '0')}`,\n      isPast: reminderTimeInMinutes < currentTimeInMinutes\n    });\n    executorsToNotify[executorId].rowIndexes.push(index + 2);\n  }\n  \n  // –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\n  if (!isNotSent && noReport && intervalMs > 0) {\n    const sentDate = parseSentDate(sentDateStr);\n    if (sentDate && (now.getTime() - sentDate.getTime()) >= intervalMs) {\n      toSendReminderCount++;\n      reminderMessages.push({\n        json: {\n          chat_id: executorId,\n          text: `üîî <b>–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</b>\\n\\nüìã –û—Ç—á—ë—Ç <b>${reportId} ${reportType}</b> –≤—Å–µ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–æ—Ç–æ –æ—Ç—á—ë—Ç–∞ (–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π) –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ –ø–æ —ç—Ç–æ–π –∑–∞–¥–∞—á–µ.`,\n          parse_mode: \"HTML\",\n          isReminder: true,\n          reportId: reportId,\n          reportType: reportType,\n          rowIndex: index + 2,\n          executorName: executorName,\n          count: oldCount + 1,\n          _isRealMessage: true\n        }\n      });\n    }\n  }\n});\n\n// –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\nconsole.log('\\n' + '='.repeat(50));\nconsole.log('–ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:');\nconsole.log(`- –ó–∞–ø–∏—Å–µ–π —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç–æ–π: ${todayCount}`);\nconsole.log(`- –ó–∞–ø–∏—Å–µ–π —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º: ${currentTimeCount}`);\nconsole.log(`- –ó–∞–ø–∏—Å–µ–π —Å –ø—Ä–æ—à–µ–¥—à–∏–º –≤—Ä–µ–º–µ–Ω–µ–º: ${pastTimeCount}`);\nconsole.log(`- –ó–∞–ø–∏—Å–µ–π –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö: ${notSentCount}`);\nconsole.log(`- –ù–æ–≤—ã—Ö –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ: ${toSendNewCount}`);\nconsole.log(`- –ü–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ: ${toSendReminderCount}`);\nconsole.log(`- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π: ${Object.keys(executorsToNotify).length}`);\nconsole.log('='.repeat(50));\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è\nconst messages = [];\n\nObject.values(executorsToNotify).forEach(data => {\n  const reportsCount = data.reports.length;\n  \n  let greetingText = '';\n  if (reportsCount === 1) {\n    greetingText = `–£ –≤–∞—Å –µ—Å—Ç—å 1 –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ.`;\n  } else {\n    greetingText = `–£ –≤–∞—Å –µ—Å—Ç—å ${reportsCount} –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π.`;\n  }\n  \n  const greetingMessage = `–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${data.executorName}!\\n\\nüìÖ <b>–î–∞—Ç–∞:</b> ${todayStr}\\n\\n\\nüîî ${greetingText}\\n\\n\\n–°–ø–∏—Å–æ–∫ –æ—Ç—á—ë—Ç–æ–≤ –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö.\\n–ß—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç, –≤—ã–±–µ—Ä–∏—Ç–µ –µ–≥–æ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –∏ –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –Ω–µ–≥–æ, –ø—Ä–∏—Å–ª–∞–≤ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ, —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–º)\\n\\n‚ö†Ô∏è <b>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ:</b>\\n‚Ä¢ –§–æ—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Ç–∞–µ–º—ã–º\\n‚Ä¢ –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ –∏–º–µ–Ω–Ω–æ –≤ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –æ—Ç—á—ë—Ç–æ–º\\n‚Ä¢ –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ\\n\\n‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ: <b>/prochital</b>\\n\\n‚ùì –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞–ø–∏—à–∏—Ç–µ /help\\n`;\n  \n  messages.push({\n    json: {\n      chat_id: data.chatId,\n      text: greetingMessage,\n      parse_mode: \"HTML\",\n      isGreeting: true,\n      executorName: data.executorName,\n      rowIndexes: data.rowIndexes,\n      reportIds: data.reports.map(r => r.reportId).join(', '),\n      _isRealMessage: true\n    }\n  });\n  \n  data.reports.forEach((report) => {\n    const reportMessage = `üìã –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å:\\n<b>üî∏ ${report.reportId} ${report.reportType}</b>\\n\\n<b>‚û°Ô∏è –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç:</b>\\n1. –°–¥–µ–ª–∞–π—Ç–µ —á–µ—Ç–∫–æ–µ —Ñ–æ—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞\\n2. –í–ê–ñ–ù–û: –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–µ–π\\n3. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π`;\n    \n    messages.push({\n      json: {\n        chat_id: data.chatId,\n        text: reportMessage,\n        parse_mode: \"HTML\",\n        isReportMessage: true,\n        reportId: report.reportId,\n        reportType: report.reportType,\n        rowIndex: report.rowIndex,\n        executorName: data.executorName,\n        _isRealMessage: true\n      }\n    });\n  });\n});\n\n// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\nmessages.push(...reminderMessages);\n\nconsole.log(`\\nüí¨ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ ${messages.length} —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏`);\n\nif (messages.length === 0) {\n  console.log('üì≠ –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç');\n  return [];\n}\n\nreturn messages;"
      },
      "name": "–ù–∞–π—Ç–∏ –∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è - –§–æ—Ç–æ",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1216,
        1488
      ],
      "id": "7bcd9df5-3be0-436e-b483-aea249d8dd8d"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "disable_notification": false,
          "parse_mode": "HTML"
        }
      },
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram - –§–æ—Ç–æ",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -720,
        1360
      ],
      "id": "2f220d15-92e9-4a54-969e-a1b2ab5c91b4",
      "webhookId": "36adf07f-ecfb-4c84-bd6f-7e5da01784be"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": " –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ": "={{ $json.values[0][0] }}",
            "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è": "={{ $json.values[0][1] }}",
            "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π": "={{ $json.values[0][2] }}",
            "row_number": "={{ $json._rowIndex }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "displayName": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "displayName": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π",
              "displayName": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true
            }
          ]
        },
        "options": {}
      },
      "name": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–µ - –§–æ—Ç–æ",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -272,
        1408
      ],
      "id": "393c10e1-0ce8-4353-8b64-aaa725df6281",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "triggerTimes": {
          "item": [
            {
              "mode": "everyMinute"
            }
          ]
        }
      },
      "name": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É - –ó–∞–¥–∞—á–∏5",
      "type": "n8n-nodes-base.cron",
      "typeVersion": 1,
      "position": [
        -1712,
        912
      ],
      "id": "4ccc91be-5c64-4c63-b28d-22df81a5b6e9"
    },
    {
      "parameters": {
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "–ó–∞–¥–∞—á–∏",
          "mode": "name"
        },
        "options": {}
      },
      "name": "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏6",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -1488,
        912
      ],
      "id": "4402e016-3e45-42dc-aa5b-d88c79e56658",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–∏—Å–∫ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–µ–∫—É—â–µ–≥–æ –∏ –ø—Ä–æ—à–µ–¥—à–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏, –≤–∫–ª—é—á–∞—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\nconst items = $input.all();\nconst now = new Date();\nconst todayStr = now.toLocaleDateString('ru-RU');\nconst executorsToNotify = {}; // –î–ª—è –Ω–æ–≤—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\nconst reminderMessages = []; // –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\n\n// –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–∏–µ —á–∞—Å—ã –∏ –º–∏–Ω—É—Ç—ã\nconst currentHours = now.getHours();\nconst currentMinutes = now.getMinutes();\nconst currentSeconds = now.getSeconds();\n\n// –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –º–∏–Ω—É—Ç–∞—Ö –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–Ω—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è\nconst currentTimeInMinutes = currentHours * 60 + currentMinutes;\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Ñ–æ—Ä–º–∞—Ç dd.mm.yyyy, hh:mm)\nfunction parseSentDate(sentDateStr) {\n  if (!sentDateStr || sentDateStr.trim() === '') return null;\n  try {\n    const [datePart, timePart] = sentDateStr.split(', ');\n    const [day, month, year] = datePart.split('.');\n    const [hours, minutes] = timePart.split(':');\n    return new Date(parseInt(year), parseInt(month) - 1, parseInt(day), parseInt(hours), parseInt(minutes));\n  } catch (e) {\n    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–∫–∏:', sentDateStr, e);\n    return null;\n  }\n}\n\n// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ (—Ñ–æ—Ä–º–∞—Ç hh:mm)\nfunction parseInterval(intervalStr) {\n  if (!intervalStr || intervalStr.trim() === '') return 0;\n  try {\n    const [hours, minutes] = intervalStr.split(':').map(Number);\n    return (hours || 0) * 60 * 60 * 1000 + (minutes || 0) * 60 * 1000;\n  } catch (e) {\n    console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞:', intervalStr, e);\n    return 0;\n  }\n}\n\n// –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ\nconsole.log('='.repeat(50));\nconsole.log(`–ü–†–û–í–ï–†–ö–ê –í–†–ï–ú–ï–ù–ò`);\nconsole.log(`–¢–µ–∫—É—â–∞—è –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è: ${now.toLocaleString('ru-RU')}`);\nconsole.log(`–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${currentHours}:${currentMinutes.toString().padStart(2, '0')}:${currentSeconds.toString().padStart(2, '0')}`);\nconsole.log(`–ú–∏–Ω—É—Ç –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–Ω—è: ${currentTimeInMinutes}`);\nconsole.log(`–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏: ${items.length - 1}`);\nconsole.log('='.repeat(50));\n\n// –°—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏\nlet todayCount = 0;\nlet pastTimeCount = 0;\nlet currentTimeCount = 0;\nlet notSentCount = 0;\nlet toSendNewCount = 0;\nlet toSendReminderCount = 0;\n\nitems.forEach((item, index) => {\n  if (index === 0) return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫\n  \n  const executorId = String(item.json['ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è'] || '');\n  const executorName = item.json['–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å'] || '';\n  const reminderDateRaw = item.json['–î–∞—Ç–∞'];\n  const reminderTimeRaw = item.json['–í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è'];\n  const sent = item.json['–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ'];\n  const sentDateStr = item.json['–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏'];\n  const taskId = item.json['ID_–∑–∞–¥–∞—á–∏'];\n  const taskName = item.json['–ó–∞–¥–∞—á–∞'];\n  const priority = item.json['–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç'] ? String(item.json['–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç']).toLowerCase() : '–Ω–∏–∑–∫–∏–π';\n  const object = item.json['–û–±—ä–µ–∫—Ç'];\n  const section = item.json['–£—á–∞—Å—Ç–æ–∫'];\n  const reportDate = item.json['–î–∞—Ç–∞ –æ—Ç—á–µ—Ç–∞'];\n  const intervalMs = parseInterval(item.json['–° –∫–∞–∫–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –µ—Å–ª–∏ –Ω–µ—Ç –æ—Ç—á—ë—Ç–∞']);\n  const oldCount = parseInt(item.json['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π'] || '0', 10);\n  const rowNumber = item.json['row_number'];\n  \n  if (!executorId || !reminderDateRaw || !taskId || !executorName || reminderTimeRaw === undefined) {\n    return;\n  }\n  \n  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –¥–∞—Ç—É\n  let reminderDate;\n  try {\n    if (typeof reminderDateRaw === 'number') {\n      reminderDate = new Date((reminderDateRaw - 25569) * 86400 * 1000);\n    } else if (typeof reminderDateRaw === 'string' && reminderDateRaw.includes('.')) {\n      const [day, month, year] = reminderDateRaw.split('.');\n      reminderDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));\n    } else {\n      reminderDate = new Date(reminderDateRaw);\n    }\n    reminderDate.setHours(0, 0, 0, 0);\n  } catch (e) {\n    console.error(`  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${index + 2}:`, e);\n    return;\n  }\n  \n  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤—Ä–µ–º—è –∏–∑ Excel —Ñ–æ—Ä–º–∞—Ç–∞\n  let reminderHours, reminderMinutes;\n  try {\n    if (typeof reminderTimeRaw === 'number') {\n      // Excel —Ö—Ä–∞–Ω–∏—Ç –≤—Ä–µ–º—è –∫–∞–∫ –¥—Ä–æ–±–Ω–æ–µ —á–∏—Å–ª–æ (1 = 24 —á–∞—Å–∞)\n      const totalMinutes = Math.round(reminderTimeRaw * 24 * 60);\n      reminderHours = Math.floor(totalMinutes / 60);\n      reminderMinutes = totalMinutes % 60;\n    } else if (typeof reminderTimeRaw === 'string') {\n      // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã\n      const cleanTime = reminderTimeRaw.trim();\n      \n      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –≤—Ä–µ–º–µ–Ω–∏ (–±–µ—Ä–µ–º –ø–µ—Ä–≤–æ–µ)\n      if (cleanTime.includes(' ')) {\n        const firstTime = cleanTime.split(' ')[0];\n        if (/^\\d{1,2}:\\d{2}$/.test(firstTime)) {\n          const [h, m] = firstTime.split(':');\n          reminderHours = parseInt(h);\n          reminderMinutes = parseInt(m);\n        } else if (/^\\d{1,2}$/.test(firstTime)) {\n          reminderHours = parseInt(firstTime);\n          reminderMinutes = 0;\n        } else {\n          console.error(`  ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ø–µ—Ä–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏: ${firstTime}`);\n          return;\n        }\n      }\n      // –ü—Ä–æ—Å—Ç–æ–π —Ñ–æ—Ä–º–∞—Ç \"—á–∞—Å—ã:–º–∏–Ω—É—Ç—ã\" (–Ω–∞–ø—Ä–∏–º–µ—Ä, \"16:14\")\n      else if (/^\\d{1,2}:\\d{2}$/.test(cleanTime)) {\n        const [h, m] = cleanTime.split(':');\n        reminderHours = parseInt(h);\n        reminderMinutes = parseInt(m);\n      }\n      // –§–æ—Ä–º–∞—Ç —Å —Å–µ–∫—É–Ω–¥–∞–º–∏ \"—á–∞—Å—ã:–º–∏–Ω—É—Ç—ã:—Å–µ–∫—É–Ω–¥—ã\" (–Ω–∞–ø—Ä–∏–º–µ—Ä, \"16:14:00\")\n      else if (/^\\d{1,2}:\\d{2}:\\d{2}$/.test(cleanTime)) {\n        const [h, m] = cleanTime.split(':');\n        reminderHours = parseInt(h);\n        reminderMinutes = parseInt(m);\n      }\n      // AM/PM —Ñ–æ—Ä–º–∞—Ç\n      else if (cleanTime.includes('AM') || cleanTime.includes('PM')) {\n        const timeParts = cleanTime.replace(/[AP]M/i, '').trim().split(':');\n        reminderHours = parseInt(timeParts[0]);\n        reminderMinutes = parseInt(timeParts[1] || '0');\n        \n        if (cleanTime.toUpperCase().includes('PM') && reminderHours < 12) {\n          reminderHours += 12;\n        } else if (cleanTime.toUpperCase().includes('AM') && reminderHours === 12) {\n          reminderHours = 0;\n        }\n      } else {\n        console.error(`  ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${index + 2}:`, reminderTimeRaw);\n        return;\n      }\n    } else {\n      console.error(`  ‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${index + 2}:`, typeof reminderTimeRaw, reminderTimeRaw);\n      return;\n    }\n  } catch (e) {\n    console.error(`  ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —Å—Ç—Ä–æ–∫–∏ ${index + 2}:`, e);\n    return;\n  }\n  \n  // –í—Ä–µ–º—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –º–∏–Ω—É—Ç–∞—Ö –æ—Ç –Ω–∞—á–∞–ª–∞ –¥–Ω—è\n  const reminderTimeInMinutes = reminderHours * 60 + reminderMinutes;\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –¥–∞—Ç–∞ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  const isToday = reminderDate.getTime() === today.getTime();\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Ä–µ–º—è —É–∂–µ –Ω–∞—Å—Ç—É–ø–∏–ª–æ –∏–ª–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º\n  const isTimeNowOrPast = reminderTimeInMinutes <= currentTimeInMinutes;\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –µ—â–µ –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ\n  const notSent = !sent || sent.toString().trim() === '' || sent !== '–î–∞';\n  const noSentDate = !sentDateStr || sentDateStr.toString().trim() === '';\n  const isNotSent = notSent && noSentDate;\n  \n  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ—Ç—á–µ—Ç–∞\n  const noReport = !reportDate || reportDate.toString().trim() === '';\n  \n  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫–∏\n  if (isToday) {\n    todayCount++;\n    if (isTimeNowOrPast) {\n      if (reminderTimeInMinutes === currentTimeInMinutes) {\n        currentTimeCount++;\n      } else {\n        pastTimeCount++;\n      }\n    }\n    if (isNotSent) notSentCount++;\n  }\n  \n  // –õ–æ–≥–∏–∫–∞ –¥–ª—è –Ω–æ–≤—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\n  if (isToday && isTimeNowOrPast && isNotSent && noReport) {\n    toSendNewCount++;\n    \n    if (!executorsToNotify[executorId]) {\n      executorsToNotify[executorId] = {\n        chatId: executorId,\n        executorName: executorName,\n        tasks: [],\n        rowIndexes: []\n      };\n    }\n    \n    executorsToNotify[executorId].tasks.push({ \n      taskId: taskId, \n      taskName: taskName,\n      priority: priority,\n      object: object,\n      section: section,\n      rowIndex: rowNumber || index + 2,\n      reminderTime: `${reminderHours}:${reminderMinutes.toString().padStart(2, '0')}`,\n      isPast: reminderTimeInMinutes < currentTimeInMinutes,\n      isNew: true,\n      oldCount: oldCount\n    });\n    executorsToNotify[executorId].rowIndexes.push(rowNumber || index + 2);\n  }\n  \n  // –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\n  if (!isNotSent && noReport && intervalMs > 0) {\n    const sentDate = parseSentDate(sentDateStr);\n    if (sentDate && (now.getTime() - sentDate.getTime()) >= intervalMs) {\n      toSendReminderCount++;\n      let priorityEmoji = '';\n      let priorityText = '';\n      switch (priority) {\n        case '–≤—ã—Å–æ–∫–∏–π':\n          priorityEmoji = 'üî¥';\n          priorityText = '–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç';\n          break;\n        case '—Å—Ä–µ–¥–Ω–∏–π':\n          priorityEmoji = 'üü°';\n          priorityText = '–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç';\n          break;\n        case '–Ω–∏–∑–∫–∏–π':\n          priorityEmoji = 'üü¢';\n          priorityText = '–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç';\n          break;\n        case '–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ':\n        case '–Ω–µ –∑–∞–±—ã—Ç—å':\n          priorityEmoji = '‚ö†Ô∏è';\n          priorityText = '–ù–µ –∑–∞–±—É–¥—å—Ç–µ';\n          break;\n        default:\n          priorityEmoji = 'üü¢';\n          priorityText = '–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç';\n      }\n      \n      reminderMessages.push({\n        json: {\n          chat_id: executorId,\n          text: `${priorityEmoji} üîî <b>–ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ</b>\\n\\n–ó–∞–¥–∞—á–∞ \"<b>${taskName}</b>\" (ID: ${taskId}) –≤—Å–µ –µ—â–µ –Ω–µ –∑–∞–∫—Ä—ã—Ç–∞.\\n\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤ –æ—Ç–≤–µ—Ç –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —ç—Ç–∏–º ID.\n          \n          –ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞ –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤–∞—à–µ–º—É –º–µ–Ω–µ–¥–∂–µ—Ä—É`,\n          parse_mode: \"HTML\",\n          isReminder: true,\n          taskId: taskId,\n          taskName: taskName,\n          priority: priority,\n          rowIndex: rowNumber || index + 2,\n          executorName: executorName,\n          count: oldCount + 1,\n          _isRealMessage: true\n        }\n      });\n    }\n  }\n});\n\n// –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞\nconsole.log('\\n' + '='.repeat(50));\nconsole.log('–ò–¢–û–ì–û–í–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:');\nconsole.log(`- –ó–∞–ø–∏—Å–µ–π —Å —Å–µ–≥–æ–¥–Ω—è—à–Ω–µ–π –¥–∞—Ç–æ–π: ${todayCount}`);\nconsole.log(`- –ó–∞–ø–∏—Å–µ–π —Å —Ç–µ–∫—É—â–∏–º –≤—Ä–µ–º–µ–Ω–µ–º: ${currentTimeCount}`);\nconsole.log(`- –ó–∞–ø–∏—Å–µ–π —Å –ø—Ä–æ—à–µ–¥—à–∏–º –≤—Ä–µ–º–µ–Ω–µ–º: ${pastTimeCount}`);\nconsole.log(`- –ó–∞–ø–∏—Å–µ–π –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö: ${notSentCount}`);\nconsole.log(`- –ù–æ–≤—ã—Ö –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ: ${toSendNewCount}`);\nconsole.log(`- –ü–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∫ –æ—Ç–ø—Ä–∞–≤–∫–µ: ${toSendReminderCount}`);\nconsole.log(`- –£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π: ${Object.keys(executorsToNotify).length}`);\nconsole.log('='.repeat(50));\n\n// –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è (–Ω–æ–≤—ã–µ)\nconst messages = [];\n\nObject.values(executorsToNotify).forEach(data => {\n  const tasksCount = data.tasks.length;\n  \n  // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–¥–∞—á\n  let greetingText = '';\n  if (tasksCount === 1) {\n    greetingText = `–£ –≤–∞—Å –µ—Å—Ç—å 1 –∑–∞–¥–∞—á–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.`;\n  } else {\n    greetingText = `–£ –≤–∞—Å –µ—Å—Ç—å ${tasksCount} –∑–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è.`;\n  }\n  \n  // –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ - –æ–±—â–µ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ\n  const greetingMessage = `üìã <b>–î–æ–±—Ä—ã–π –¥–µ–Ω—å, ${data.executorName}!</b>\\n\\nüìÖ <b>–î–∞—Ç–∞:</b> ${todayStr}\\n\\n${greetingText}\\n\\n–°–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –≤—ã –ø–æ–ª—É—á–∏—Ç–µ –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö.\\n–ß—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á—ë—Ç, –æ—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–¥–∞—á–µ–π, —É–∫–∞–∑–∞–≤:\\n‚Ä¢ –°—Ç–∞—Ç—É—Å: –≤—ã–ø–æ–ª–Ω–µ–Ω–æ / —á–∞—Å—Ç–∏—á–Ω–æ / –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ\\n‚Ä¢ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)\\n\\nüìã <b>–ü—Ä–∏–º–µ—Ä –æ—Ç—á–µ—Ç–∞:</b>\\n<pre>–≤—ã–ø–æ–ª–Ω–µ–Ω–æ\\n–í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ</pre>\\n\\n–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è! üí™\\n\\n‚úÖ <b>–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–æ–ª—É—á–µ–Ω–∏–µ:</b> <b>/poluchil</b>\\n\\n‚ùì –ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã, –Ω–∞–∂–º–∏—Ç–µ –∏–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ /help`;\n  \n  // –í–ê–ñ–ù–û: –î–æ–±–∞–≤–ª—è–µ–º –≤—Å—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n  messages.push({\n    json: {\n      chat_id: data.chatId,\n      text: greetingMessage,\n      parse_mode: \"HTML\",\n      isGreeting: true,\n      executorName: data.executorName,\n      rowIndexes: data.rowIndexes,\n      _isRealMessage: true\n    }\n  });\n  \n  // –ó–∞—Ç–µ–º –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏\n  data.tasks.forEach((task) => {\n    let priorityEmoji = '';\n    let priorityText = '';\n    switch (task.priority) {\n      case '–≤—ã—Å–æ–∫–∏–π':\n        priorityEmoji = 'üî¥';\n        priorityText = '–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç';\n        break;\n      case '—Å—Ä–µ–¥–Ω–∏–π':\n        priorityEmoji = 'üü°';\n        priorityText = '–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç';\n        break;\n      case '–Ω–∏–∑–∫–∏–π':\n        priorityEmoji = 'üü¢';\n        priorityText = '–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç';\n        break;\n      case '–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ':\n      case '–Ω–µ –∑–∞–±—ã—Ç—å':\n        priorityEmoji = '‚ö†Ô∏è';\n        priorityText = '–ù–µ –∑–∞–±—É–¥—å—Ç–µ';\n        break;\n      default:\n        priorityEmoji = 'üü¢';\n        priorityText = '–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç';\n    }\n    \n    const count = task.isNew ? 1 : task.oldCount + 1;\n    const taskMessage = `${priorityEmoji} <b>${priorityText}:</b>\\n<b>${task.taskId} ${task.taskName} </b> | ${task.object}, ${task.section} \\n\\nüìù <b>–ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç—á–µ—Ç:</b>\\n–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ, —É–∫–∞–∑–∞–≤:\\n‚Ä¢ –°—Ç–∞—Ç—É—Å: –≤—ã–ø–æ–ª–Ω–µ–Ω–æ / —á–∞—Å—Ç–∏—á–Ω–æ / –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ\\n‚Ä¢ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)\\n\\nüìã <b>–ü—Ä–∏–º–µ—Ä –æ—Ç—á–µ—Ç–∞:</b>\\n<pre>–≤—ã–ø–æ–ª–Ω–µ–Ω–æ\\n–í—Å–µ –≤ –ø–æ—Ä—è–¥–∫–µ</pre>`;\n    \n    messages.push({\n      json: {\n        chat_id: data.chatId,\n        text: taskMessage,\n        parse_mode: \"HTML\",\n        isTaskMessage: true,\n        taskId: task.taskId,\n        taskName: task.taskName,\n        priority: task.priority,\n        rowIndex: task.rowIndex,\n        executorName: data.executorName,\n        count: count,\n        _isRealMessage: true\n      }\n    });\n  });\n});\n\n// –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è\nmessages.push(...reminderMessages);\n\nconsole.log(`\\nüí¨ –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–æ ${messages.length} —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏`);\n\n// –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤\nif (messages.length === 0) {\n  console.log('üì≠ –ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç');\n  return [];\n}\n\nreturn messages;"
      },
      "name": "–ù–∞–π—Ç–∏ –∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è - –ó–∞–¥–∞—á–∏5",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1280,
        912
      ],
      "id": "14208133-7c36-4c3a-a721-81a73ca4b1ee"
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $items().length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "name": "–ï—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏? - –ó–∞–¥–∞—á–∏5",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -1104,
        912
      ],
      "id": "85d0aadb-dc66-4d7a-b7f8-d0825cf5a842"
    },
    {
      "parameters": {
        "chatId": "={{ $json.chat_id }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "disable_notification": false,
          "parse_mode": "HTML"
        }
      },
      "name": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram - –ó–∞–¥–∞—á–∏5",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [
        -864,
        752
      ],
      "id": "b5b839f0-f166-4f9c-840b-2b7bd4204903",
      "webhookId": "37d5ed28-94f5-4992-bc94-ddefa95bc6a4"
    },
    {
      "parameters": {
        "jsCode": "// –ò–∑–≤–ª–µ–∫–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–∑ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\nconst allMessages = $input.all();\n\n// –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è\nconst now = new Date();\nconst sentDateTime = now.toLocaleString('ru-RU', {\n  day: '2-digit',\n  month: '2-digit',\n  year: 'numeric',\n  hour: '2-digit',\n  minute: '2-digit'\n});\n\n// –°–æ–∑–¥–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏\nconst updates = [];\nconst processedRows = new Set();\n\n// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è - –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ, –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ\nallMessages.forEach(msg => {\n  // –î–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n  if (msg.json.isGreeting === true && msg.json.rowIndexes) {\n    const rowIndexes = msg.json.rowIndexes || [];\n    rowIndexes.forEach(rowIndex => {\n      if (rowIndex && !isNaN(rowIndex) && !processedRows.has(rowIndex)) {\n        processedRows.add(rowIndex);\n        updates.push({\n          json: {\n            values: [[\"–î–∞\", sentDateTime, \"1\"]], // –ù–∞—á–∞–ª—å–Ω—ã–π —Å—á–µ—Ç—á–∏–∫ = 1\n            _rowIndex: Number(rowIndex)\n          }\n        });\n      }\n    });\n  }\n  \n  // –î–ª—è –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π\n  if (msg.json.isReminder === true && msg.json.rowIndex) {\n    const rowIndex = msg.json.rowIndex;\n    const count = msg.json.count || 1;\n    if (rowIndex && !isNaN(rowIndex) && !processedRows.has(rowIndex)) {\n      processedRows.add(rowIndex);\n      updates.push({\n        json: {\n          values: [[\"–î–∞\", sentDateTime, String(count)]],\n          _rowIndex: Number(rowIndex)\n        }\n      });\n    }\n  }\n});\nconst ddcm = \"Workflow by Artem Boiko - DataDrivenConstruction.io\";\nconsole.log(`–ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–æ ${updates.length} –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π`);\nreturn updates.length > 0 ? updates : [];"
      },
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ó–∞–¥–∞—á–∏5",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -688,
        896
      ],
      "id": "773fc1ea-c9f0-44e7-bcdb-c4559053c75f"
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $items().length }}",
              "operation": "larger"
            }
          ]
        }
      },
      "name": "–ï—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è? - –ó–∞–¥–∞—á–∏5",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        -496,
        896
      ],
      "id": "a757ff6d-0ec5-4d5e-a0aa-afccf591e223"
    },
    {
      "parameters": {
        "operation": "update",
        "documentId": {
          "__rl": true,
          "value": "14V795nago6Qt7PpECflnuFSTdTvwo-fWEG_n83wgKug",
          "mode": "id"
        },
        "sheetName": {
          "__rl": true,
          "value": "–ó–∞–¥–∞—á–∏",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ": "={{ $json.values[0][0] }}",
            "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏": "={{ $json.values[0][1] }}",
            "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π": "={{ $json.values[0][2] }}",
            "row_number": "={{ $json._rowIndex }}"
          },
          "matchingColumns": [
            "row_number"
          ],
          "schema": [
            {
              "id": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "displayName": "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
              "displayName": "–î–∞—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π",
              "displayName": "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.6,
      "position": [
        -272,
        816
      ],
      "id": "d4295c54-d4b0-4f59-95ba-a5536e361636",
      "name": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–µ - –ó–∞–¥–∞—á–∏5",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "zpzCvGwtELgn6FEq",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {},
      "name": "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π - –ó–∞–¥–∞—á–∏5",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -880,
        976
      ],
      "id": "9575554a-3dd3-4cf0-a5a8-743404ae00f4"
    },
    {
      "parameters": {},
      "name": "–ù–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π - –ó–∞–¥–∞—á–∏5",
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        -272,
        992
      ],
      "id": "c1912d1e-795c-45cb-a850-ecbbca474dcf"
    },
    {
      "parameters": {
        "content": "## üöÄ –¢–û–ß–ö–ê –í–•–û–î–ê\n\n### Telegram Webhook\n\n–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:\n- –ö–æ–º–∞–Ω–¥—ã (/start, /help, /status, etc.)\n- –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è –æ—Ç—á–µ—Ç–æ–≤\n- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –æ—Ç—á–µ—Ç—ã –æ –∑–∞–¥–∞—á–∞—Ö\n- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è",
        "height": 408,
        "width": 798,
        "color": 6
      },
      "id": "2d4d6047-8b67-4982-aee8-9b1610917672",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -880,
        1808
      ]
    },
    {
      "parameters": {
        "content": "## üë§ –ë–õ–û–ö –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò\n\n### –ü—Ä–æ—Ü–µ—Å—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π:\n\n1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –±–∞–∑–µ\n2. **–ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö** - –µ—Å–ª–∏ –Ω–æ–≤—ã–π, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∏–º—è –∏ –∫–æ–º–ø–∞–Ω–∏—é\n3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü—É** - –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Google Sheets\n4. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
        "height": 570,
        "width": 1712,
        "color": 4
      },
      "id": "d34ab840-d5ac-4b9a-b376-2824b02d5b4b",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {
        "content": "## üì∏ –û–ë–†–ê–ë–û–¢–ö–ê –§–û–¢–û–û–¢–ß–ï–¢–û–í\n\n### –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:\n\n1. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** - –ø–∞—Ä—Å–∏–Ω–≥ ID –∑–∞–¥–∞—á–∏ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è\n2. **–ó–∞–≥—Ä—É–∑–∫–∞ –≤ Drive** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–æ—Ç–æ –≤ Google Drive\n3. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞** - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ç–æ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–∏\n4. **–ó–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏\n5. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ",
        "height": 536,
        "width": 1716,
        "color": 5
      },
      "id": "224f373d-afb3-47cf-9110-ee7e10085daa",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        1056
      ]
    },
    {
      "parameters": {
        "content": "## üìã –û–ë–†–ê–ë–û–¢–ö–ê –¢–ï–ö–°–¢–û–í–´–• –û–¢–ß–ï–¢–û–í\n\n### –û—Ç—á–µ—Ç—ã –ø–æ –∑–∞–¥–∞—á–∞–º:\n\n- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∑–∞–¥–∞—á–∏\n- –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–∞ (–≤—ã–ø–æ–ª–Ω–µ–Ω–æ/—á–∞—Å—Ç–∏—á–Ω–æ/–Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ)\n- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ –∑–∞–¥–∞—á\n- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é",
        "height": 840,
        "width": 2334,
        "color": 6
      },
      "id": "167e34af-6067-4b88-9700-3a4941bdcd3a",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        2048
      ]
    },
    {
      "parameters": {
        "content": "## üìç –û–ë–†–ê–ë–û–¢–ö–ê –ì–ï–û–õ–û–ö–ê–¶–ò–ò\n\n### GPS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:\n\n- –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –æ—Ç—á–µ—Ç—É\n- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–∞—Ä—Ç—É\n- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ",
        "height": 548,
        "width": 2012,
        "color": 3
      },
      "id": "f8653e53-d853-4294-8e02-54f4c4b0f0f4",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        2912
      ]
    },
    {
      "parameters": {
        "content": "## ‚è∞ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–Ø –§–û–¢–û–û–¢–ß–Å–¢–´\n\n### –§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª:\n–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç—ã.\n\n**–õ–æ–≥–∏–∫–∞:**\n- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏\n- –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π\n- –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π\n- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏",
        "height": 554,
        "width": 1710,
        "color": 2
      },
      "id": "f36f4533-229a-45f2-99fe-1c7b1e091f91",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1776,
        1200
      ]
    },
    {
      "parameters": {
        "content": "## ‚è∞ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–Ø\n\n### –ó–∞–¥–∞—á–∏:\n–ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É –∑–∞–¥–∞—á –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è–º.\n\n**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã:**\n- üî¥ –í—ã—Å–æ–∫–∏–π\n- üü° –°—Ä–µ–¥–Ω–∏–π\n- üü¢ –ù–∏–∑–∫–∏–π\n- ‚ö†Ô∏è –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ",
        "height": 614,
        "width": 1710,
        "color": 2
      },
      "id": "1866852d-c855-46e8-955d-9203dc4b159d",
      "name": "Sticky Note6",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1776,
        544
      ]
    },
    {
      "parameters": {
        "content": "## üîß –°–õ–£–ñ–ï–ë–ù–´–ï –ö–û–ú–ê–ù–î–´\n\n### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:\n\n- **/start** - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ\n- **/help** - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ —Ä–∞–±–æ—Ç–µ\n- **/status** - —Å—Ç–∞—Ç—É—Å –æ—Ç—á–µ—Ç–æ–≤ –∑–∞ –¥–µ–Ω—å\n- **/report** - —Ä—É—á–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞\n- **/prochital** - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø—Ä–æ—á—Ç–µ–Ω–∏—è (—Ñ–æ—Ç–æ)\n- **/poluchil** - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–∏—è (–∑–∞–¥–∞—á–∏)",
        "height": 442,
        "width": 1710
      },
      "id": "40cba7f8-46ce-41ba-9028-2d60bbda39f9",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        592
      ]
    },
    {
      "parameters": {
        "content": "## üìä –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–•\n\n### Google Sheets —Ç–∞–±–ª–∏—Ü—ã:\n1. **–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏** - –¥–∞–Ω–Ω—ã–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π\n2. **–§–æ—Ç–æ –∂—É—Ä–Ω–∞–ª –æ—Ç—á—ë—Ç** - –≤—Å–µ —Ñ–æ—Ç–æ–æ—Ç—á–µ—Ç—ã\n3. **–ó–∞–¥–∞—á–∏** - —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á –∏ –∏—Ö —Å—Ç–∞—Ç—É—Å—ã\n\n### –ö–ª—é—á–µ–≤—ã–µ –ø–æ–ª—è:\n- **ID_–∑–∞–¥–∞—á–∏** / **ID_–æ—Ç—á—ë—Ç–∞** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä\n- **ID –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è** - Telegram Chat ID\n- **–°—Ç–∞—Ç—É—Å** - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è",
        "height": 380,
        "width": 400,
        "color": 3
      },
      "id": "80afe2a2-8959-4076-95fc-1a683527ddaf",
      "name": "Sticky Note8",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1760,
        1808
      ]
    },
    {
      "parameters": {
        "content": "## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ú–û–ú–ï–ù–¢–´\n1. **ID_–∑–∞–¥–∞—á–∏ = ID_–æ—Ç—á—ë—Ç–∞** - —ç—Ç–æ –æ–¥–∏–Ω –∏ —Ç–æ—Ç –∂–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä\n2. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤** - –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ –º–æ–≥—É—Ç –æ—Ç–Ω–æ—Å–∏—Ç—å—Å—è –∫ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ\n3. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è** - –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º\n4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏** - —É—á–∏—Ç—ã–≤–∞–µ—Ç —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å Europe/Minsk",
        "height": 280,
        "width": 400,
        "color": 3
      },
      "id": "d1be70c3-c21a-4f04-9d92-e33442cd397d",
      "name": "Sticky Note9",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1760,
        2208
      ]
    },
    {
      "parameters": {
        "content": "## üîÑ –ü–†–û–¶–ï–°–° –û–ë–†–ê–ë–û–¢–ö–ò –§–û–¢–û\n\n1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Ñ–æ—Ç–æ\n2. –°–∏—Å—Ç–µ–º–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç ID_–∑–∞–¥–∞—á–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è\n3. –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ Google Drive\n4. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ\n5. –ï—Å–ª–∏ –∑–∞–ø–∏—Å—å –µ—Å—Ç—å - –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π\n6. –ï—Å–ª–∏ –Ω–µ—Ç - —Å–æ–∑–¥–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å\n7. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
        "height": 410,
        "width": 3532,
        "color": 5
      },
      "id": "8e1fc55e-265e-4cce-9901-07852833ad39",
      "name": "Sticky Note10",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        0,
        1616
      ]
    },
    {
      "parameters": {
        "jsCode": "// –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞—á–∏\nconst input = $json;\n\n// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –¥–∞–Ω–Ω—ã—Ö\nif (!input || !input.lookup || !input.filesGroup) {\n  console.error('–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞–Ω–Ω—ã–µ');\n  return [];\n}\n\nconst lookupResult = input.lookup;\nconst filesGroup = input.filesGroup;\n\nif (lookupResult.length === 0) {\n  console.error('–ù–µ –Ω–∞–π–¥–µ–Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –∑–∞–ø–∏—Å—å');\n  return [];\n}\n\n// –ë–µ—Ä–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–ø–∏—Å—å\nconst existing = lookupResult[0];\nconst rowNumber = existing._rowNumber || 2;\n\n// –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤\nconst newFileNames = [];\nconst newFileLinks = [];\nconst newFileIds = [];\nlet newTotalSize = 0;\nconst newCaptions = [];\nconst newMediaGroupIds = new Set();\n\n// –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º –Ω–æ–≤—ã–º —Ñ–∞–π–ª–∞–º\nfilesGroup.forEach(file => {\n  if (file && file.fileData) {\n    // –î–æ–±–∞–≤–ª—è–µ–º –∏–º—è —Ñ–∞–π–ª–∞\n    if (file.fileData.fileName) {\n      newFileNames.push(file.fileData.fileName);\n    }\n    \n    // –î–æ–±–∞–≤–ª—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Ñ–∞–π–ª\n    if (file.fileData.fileLink) {\n      newFileLinks.push(file.fileData.fileLink);\n    }\n    \n    // –î–æ–±–∞–≤–ª—è–µ–º Telegram File ID\n    if (file.fileData.fileId) {\n      newFileIds.push(file.fileData.fileId);\n    }\n    \n    // –°—É–º–º–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä\n    newTotalSize += file.fileData.fileSize || 0;\n    \n    // –°–æ–±–∏—Ä–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏\n    if (file.reportData?.caption) {\n      newCaptions.push(file.reportData.caption);\n    }\n    \n    // –°–æ–±–∏—Ä–∞–µ–º Media Group IDs\n    if (file.messageData?.mediaGroupId) {\n      newMediaGroupIds.add(file.messageData.mediaGroupId);\n    }\n  }\n});\n\n// –ü–∞—Ä—Å–∏–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è\nconst currentCount = parseInt(existing['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤']) || 0;\nconst newFilesCount = newFileNames.length;\nconst totalCount = currentCount + newFilesCount;\n\n// –û–±—ä–µ–¥–∏–Ω—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∏ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ\nconst allFileNames = existing['–ò–º—è —Ñ–∞–π–ª–∞'] ? \n  existing['–ò–º—è —Ñ–∞–π–ª–∞'] + ', ' + newFileNames.join(', ') : \n  newFileNames.join(', ');\n\nconst allFileLinks = existing['–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª'] ? \n  existing['–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª'] + ', ' + newFileLinks.join(', ') : \n  newFileLinks.join(', ');\n\nconst allFileIds = existing['Telegram File ID'] ? \n  existing['Telegram File ID'] + ', ' + newFileIds.join(', ') : \n  newFileIds.join(', ');\n\nconst totalSize = (parseInt(existing['–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–±–∞–π—Ç)']) || 0) + newTotalSize;\n\n// –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å\nconst newStatus = totalCount === 1 ? \n  '–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Drive' : \n  `–í—Å–µ ${totalCount} —Ñ–∞–π–ª–∞(–æ–≤) –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ Drive`;\n\n// –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π\nconst existingComment = existing['–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π'] || '';\nconst uniqueNewCaptions = [...new Set(newCaptions)];\nconst newComment = uniqueNewCaptions.length > 0 ? \n  (existingComment ? existingComment + '; ' + uniqueNewCaptions.join('; ') : uniqueNewCaptions.join('; ')) : \n  existingComment;\n\n// –û–±–Ω–æ–≤–ª—è–µ–º Media Group IDs\nconst existingMediaGroups = existing['Media Group ID'] ? existing['Media Group ID'].split(', ') : [];\nconst allMediaGroups = new Set([...existingMediaGroups, ...newMediaGroupIds]);\nconst mediaGroupIdsStr = Array.from(allMediaGroups).join(', ');\n\n// –ë–µ—Ä–µ–º –¥–∞–Ω–Ω—ã–µ –æ—Ç—á–µ—Ç–∞\nconst reportData = input.reportData;\n\nconsole.log(`–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –¥–ª—è ID_–∑–∞–¥–∞—á–∏ ${existing['ID_–æ—Ç—á—ë—Ç–∞']}:`, {\n  existingFiles: currentCount,\n  newFiles: newFilesCount,\n  totalFiles: totalCount\n});\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è\nreturn [{\n  json: {\n    rowNumber: rowNumber,\n    updateData: {\n      '–ò–º—è —Ñ–∞–π–ª–∞': allFileNames,\n      '–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–∞–π–ª': allFileLinks,\n      'Telegram File ID': allFileIds,\n      '–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–±–∞–π—Ç)': String(totalSize),\n      '–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏': newStatus,\n      '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤': String(totalCount),\n      '–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π': newComment,\n      'Media Group ID': mediaGroupIdsStr,\n      '–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç': new Date().toLocaleString('ru-RU')\n    },\n    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è\n    confirmationData: {\n      '_chatId': reportData.chatId,\n      '_taskId': existing['ID_–æ—Ç—á—ë—Ç–∞'],\n      '_originalMessageId': reportData.originalMessageId,\n      '_filesCount': totalCount,\n      '_newFilesCount': newFilesCount,\n      '_fileNames': allFileNames,\n      'ID_–æ—Ç—á—ë—Ç–∞': existing['ID_–æ—Ç—á—ë—Ç–∞'],\n      '–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞': existing['–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞'],\n      '–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç—á—ë—Ç': new Date().toLocaleString('ru-RU'),\n      '–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏': newStatus\n    }\n  }\n}];"
      },
      "name": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è2",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2752,
        1712
      ],
      "id": "001c3344-dd57-43a9-8cdf-5636dd0ca052"
    }
  ],
  "pinData": {},
  "connections": {
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å register_user1": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞—Ç—å –ª–∏—Å—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞—Ç—å –ª–∏—Å—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–µ–π1": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é1": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å1": {
      "main": [
        [],
        [
          {
            "node": "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ1": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å1": {
      "main": [
        [
          {
            "node": "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Telegram Webhook - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π": {
      "main": [
        [
          {
            "node": "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å send_message",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å prochital",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É no_reply",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å check_status",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å send_report_menu",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å manual_report",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å register_user1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å complete_registration1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_photo3",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_report1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∫–∞ poluchil1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∑–∞–¥–∞—á–∏1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_location2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å send_message": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å prochital": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞—Ç—å –ª–∏—Å—Ç –¥–ª—è prochital",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞—Ç—å –ª–∏—Å—Ç –¥–ª—è prochital": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è": {
      "main": [
        [
          {
            "node": "–§–∏–ª—å—Ç—Ä prochital summary",
            "type": "main",
            "index": 0
          },
          {
            "node": "–§–∏–ª—å—Ç—Ä –≤–∞–ª–∏–¥–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—á—Ç–µ–Ω–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–§–∏–ª—å—Ç—Ä prochital summary": {
      "main": [
        [
          {
            "node": "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç prochital",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–§–∏–ª—å—Ç—Ä –≤–∞–ª–∏–¥–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—á—Ç–µ–Ω–∏—è": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—á—Ç–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—á—Ç–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ prochital",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç prochital": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ prochital",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É no_reply": {
      "main": [
        [
          {
            "node": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å check_status": {
      "main": [
        [
          {
            "node": "–ß–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ß–∏—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞": {
      "main": [
        [
          {
            "node": "–°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ –ª–∏—Å—Ç—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ–±—Ä–∞—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ –ª–∏—Å—Ç—É": {
      "main": [
        [
          {
            "node": "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å send_report_menu": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å manual_report": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø—Ä–æ—Å–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏1": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å complete_registration1": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏": {
      "main": [
        [
          {
            "node": "–ó–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø–∏—Å–∞—Ç—å –Ω–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è": {
      "main": [
        [
          {
            "node": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø–æ –∑–∞–¥–∞—á–µ": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–¥–∞—á—É1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge lookup and grouped files",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge lookup and grouped files": {
      "main": [
        [
          {
            "node": "–°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∑–∞–¥–∞—á–∞?1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge for confirmation": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ": {
      "main": [
        [
          {
            "node": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_photo3": {
      "main": [
        [
          {
            "node": "–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ4": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É2": {
      "main": [
        [
          {
            "node": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Ñ–æ—Ç–æ4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –∏ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª4": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞4": {
      "main": [
        [
          {
            "node": "–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Google Drive4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ Google Drive4": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–ø–∏—Å–∏5": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ—Ç–æ–∫–∏ —Ñ–∞–π–ª–æ–≤2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –æ—à–∏–±–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è4": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ—Ç–æ–∫–∏ —Ñ–∞–π–ª–æ–≤2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å –ø–æ—Ç–æ–∫–∏ —Ñ–∞–π–ª–æ–≤2": {
      "main": [
        [
          {
            "node": "–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø–æ –∑–∞–¥–∞—á–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∑–∞–¥–∞—á—É1": {
      "main": [
        [
          {
            "node": "Merge lookup and grouped files",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∑–∞–¥–∞—á–∞?1": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è2": {
      "main": [
        [
          {
            "node": "–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É –æ—Ç—á–µ—Ç–æ–≤1",
            "type": "main",
            "index": 0
          },
          {
            "node": "Merge for confirmation",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ2": {
      "main": [
        [
          {
            "node": "Merge for confirmation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–î–æ–±–∞–≤–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É –æ—Ç—á–µ—Ç–æ–≤1": {
      "main": [
        [
          {
            "node": "Merge for confirmation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∑–∞–¥–∞—á–∏1": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏1": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ID1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ ID1": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_report1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_report1": {
      "main": [
        [
          {
            "node": "–ò–∑–≤–ª–µ—á—å –æ—Ç—á–µ—Ç—ã1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–∑–≤–ª–µ—á—å –æ—Ç—á–µ—Ç—ã1": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏1": {
      "main": [
        [
          {
            "node": "–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ1": {
      "main": [
        [
          {
            "node": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç—á–µ—Ç–∞1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∫–∞ poluchil1": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è1",
            "type": "main",
            "index": 0
          },
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ poluchil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è1": {
      "main": [
        [
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ—á—Ç–µ–Ω–∏—è1": {
      "main": [
        [
          {
            "node": "–§–∏–ª—å—Ç—Ä –≤–∞–ª–∏–¥–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—á—Ç–µ–Ω–∏—è1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–§–∏–ª—å—Ç—Ä –≤–∞–ª–∏–¥–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—á—Ç–µ–Ω–∏—è1": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—á—Ç–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—á—Ç–µ–Ω–∏–µ –≤ —Ç–∞–±–ª–∏—Ü–µ1": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ poluchil",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É1": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ –∫–æ–º–∞–Ω–¥—É1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∏–ø –¥–µ–π—Å—Ç–≤–∏—è1": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –æ—Ç—á–µ—Ç–∞1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ù–∞–π—Ç–∏ –∑–∞–¥–∞—á—É –¥–ª—è GPS": {
      "main": [
        [
          {
            "node": "–ó–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–¥–∞—á–∞ –Ω–∞–π–¥–µ–Ω–∞?": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–∏—Ç—å GPS –≤ —Ç–∞–±–ª–∏—Ü–µ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–û—à–∏–±–∫–∞ - –∑–∞–¥–∞—á–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±–Ω–æ–≤–∏—Ç—å GPS –≤ —Ç–∞–±–ª–∏—Ü–µ": {
      "main": [
        [
          {
            "node": "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ GPS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å process_location2": {
      "main": [
        [
          {
            "node": "–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–∑–≤–ª–µ—á—å –¥–∞–Ω–Ω—ã–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—à–∏–±–∫—É –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1": {
      "main": [
        [
          {
            "node": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ù–∞–π—Ç–∏ –∑–∞–¥–∞—á—É –¥–ª—è GPS",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏?": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram - –§–æ—Ç–æ",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è?": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–µ - –§–æ—Ç–æ",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ù–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É - –§–æ—Ç–æ": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –∂—É—Ä–Ω–∞–ª–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ç–æ –∂—É—Ä–Ω–∞–ª–∞": {
      "main": [
        [
          {
            "node": "–ù–∞–π—Ç–∏ –∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è - –§–æ—Ç–æ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ù–∞–π—Ç–∏ –∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è - –§–æ—Ç–æ": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É - –ó–∞–¥–∞—á–∏5": {
      "main": [
        [
          {
            "node": "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞—á–∏6": {
      "main": [
        [
          {
            "node": "–ù–∞–π—Ç–∏ –∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è - –ó–∞–¥–∞—á–∏5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ù–∞–π—Ç–∏ –∏ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è - –ó–∞–¥–∞—á–∏5": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏? - –ó–∞–¥–∞—á–∏5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏? - –ó–∞–¥–∞—á–∏5": {
      "main": [
        [
          {
            "node": "–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram - –ó–∞–¥–∞—á–∏5",
            "type": "main",
            "index": 0
          },
          {
            "node": "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ó–∞–¥–∞—á–∏5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π - –ó–∞–¥–∞—á–∏5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - –ó–∞–¥–∞—á–∏5": {
      "main": [
        [
          {
            "node": "–ï—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è? - –ó–∞–¥–∞—á–∏5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ï—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è? - –ó–∞–¥–∞—á–∏5": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–µ - –ó–∞–¥–∞—á–∏5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ù–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π - –ó–∞–¥–∞—á–∏5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è2": {
      "main": [
        [
          {
            "node": "Merge for confirmation",
            "type": "main",
            "index": 1
          },
          {
            "node": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "",
  "meta": {
    "instanceId": "1d7b1da65c471e434188555a2959bd7f825cdfb684701b1bb9481fb29d0bd489"
  },
  "tags": []
}